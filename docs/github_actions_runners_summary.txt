GitHub REST API – Actions: Self-hosted runners (API version 2022-11-28)
Source: https://docs.github.com/en/rest/actions/self-hosted-runners?apiVersion=2022-11-28

Overview
- Use these endpoints to register, list, inspect, label, and remove self-hosted runners.
- Auth: Requires admin access. Org endpoints typically need admin:org (and repo for private repos). Repo endpoints typically need repo scope.
- Recommended header: Accept: application/vnd.github+json
- Required header for versioning: X-GitHub-Api-Version: 2022-11-28

Organization-level endpoints
1) List self-hosted runners for an organization
   - GET /orgs/{org}/actions/runners
   - Query: name, per_page (max 100, default 30), page (default 1)

2) List runner applications for an organization
   - GET /orgs/{org}/actions/runners/downloads

3) Create configuration for a just-in-time runner for an organization
   - POST /orgs/{org}/actions/runners/generate-jitconfig
   - Body: name, runner_group_id, labels, work_folder

4) Create a registration token for an organization
   - POST /orgs/{org}/actions/runners/registration-token

5) Create a remove token for an organization
   - POST /orgs/{org}/actions/runners/remove-token

6) Get a self-hosted runner for an organization
   - GET /orgs/{org}/actions/runners/{runner_id}

7) Delete a self-hosted runner from an organization
   - DELETE /orgs/{org}/actions/runners/{runner_id}

8) List labels for a self-hosted runner for an organization
   - GET /orgs/{org}/actions/runners/{runner_id}/labels

9) Add custom labels to a self-hosted runner for an organization
   - POST /orgs/{org}/actions/runners/{runner_id}/labels
   - Body: labels (array of strings)

10) Set custom labels for a self-hosted runner for an organization
    - PUT /orgs/{org}/actions/runners/{runner_id}/labels
    - Body: labels (array of strings)

11) Remove all custom labels from a self-hosted runner for an organization
    - DELETE /orgs/{org}/actions/runners/{runner_id}/labels

12) Remove a custom label from a self-hosted runner for an organization
    - DELETE /orgs/{org}/actions/runners/{runner_id}/labels/{name}

Repository-level endpoints
1) List self-hosted runners for a repository
   - GET /repos/{owner}/{repo}/actions/runners
   - Query: name, per_page (max 100, default 30), page (default 1)

2) List runner applications for a repository
   - GET /repos/{owner}/{repo}/actions/runners/downloads

3) Create configuration for a just-in-time runner for a repository
   - POST /repos/{owner}/{repo}/actions/runners/generate-jitconfig
   - Body: name, runner_group_id, labels, work_folder

4) Create a registration token for a repository
   - POST /repos/{owner}/{repo}/actions/runners/registration-token

5) Create a remove token for a repository
   - POST /repos/{owner}/{repo}/actions/runners/remove-token

6) Get a self-hosted runner for a repository
   - GET /repos/{owner}/{repo}/actions/runners/{runner_id}

7) Delete a self-hosted runner from a repository
   - DELETE /repos/{owner}/{repo}/actions/runners/{runner_id}

8) List labels for a self-hosted runner for a repository
   - GET /repos/{owner}/{repo}/actions/runners/{runner_id}/labels

9) Add custom labels to a self-hosted runner for a repository
   - POST /repos/{owner}/{repo}/actions/runners/{runner_id}/labels
   - Body: labels (array of strings)

10) Set custom labels for a self-hosted runner for a repository
    - PUT /repos/{owner}/{repo}/actions/runners/{runner_id}/labels
    - Body: labels (array of strings)

11) Remove all custom labels from a self-hosted runner for a repository
    - DELETE /repos/{owner}/{repo}/actions/runners/{runner_id}/labels

12) Remove a custom label from a self-hosted runner for a repository
    - DELETE /repos/{owner}/{repo}/actions/runners/{runner_id}/labels/{name}

Typical request headers
- Accept: application/vnd.github+json
- Authorization: Bearer <YOUR-TOKEN>
- X-GitHub-Api-Version: 2022-11-28

Tailored curl examples for SBS-GIVC/sbs
Set shared variables first:
- export GH_OWNER="SBS-GIVC"
- export GH_REPO="sbs"
- export GH_TOKEN="<YOUR-TOKEN>"
- export API_VERSION="2022-11-28"

1) List self-hosted runners for the repo
curl -L \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: Bearer ${GH_TOKEN}" \
  -H "X-GitHub-Api-Version: ${API_VERSION}" \
  "https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/actions/runners"

2) Create a registration token for the repo (use this with ./config.sh)
curl -L -X POST \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: Bearer ${GH_TOKEN}" \
  -H "X-GitHub-Api-Version: ${API_VERSION}" \
  "https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/actions/runners/registration-token"

3) Create a remove token for the repo (use before removing runner)
curl -L -X POST \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: Bearer ${GH_TOKEN}" \
  -H "X-GitHub-Api-Version: ${API_VERSION}" \
  "https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/actions/runners/remove-token"

4) List runner application downloads (to pick the right binary)
curl -L \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: Bearer ${GH_TOKEN}" \
  -H "X-GitHub-Api-Version: ${API_VERSION}" \
  "https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/actions/runners/downloads"

5) Get a specific runner by ID (replace RUNNER_ID)
curl -L \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: Bearer ${GH_TOKEN}" \
  -H "X-GitHub-Api-Version: ${API_VERSION}" \
  "https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/actions/runners/RUNNER_ID"

6) Add custom labels to a runner (replace RUNNER_ID)
curl -L -X POST \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: Bearer ${GH_TOKEN}" \
  -H "X-GitHub-Api-Version: ${API_VERSION}" \
  "https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/actions/runners/RUNNER_ID/labels" \
  -d '{"labels":["brainsait-pi","arm64"]}'

7) Remove a custom label from a runner (replace RUNNER_ID and LABEL)
curl -L -X DELETE \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: Bearer ${GH_TOKEN}" \
  -H "X-GitHub-Api-Version: ${API_VERSION}" \
  "https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/actions/runners/RUNNER_ID/labels/LABEL"

8) Delete a runner from the repo (replace RUNNER_ID)
curl -L -X DELETE \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: Bearer ${GH_TOKEN}" \
  -H "X-GitHub-Api-Version: ${API_VERSION}" \
  "https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/actions/runners/RUNNER_ID"

Step-by-step checklist for runner setup using the REST endpoints
1) Create a repo registration token via the REST API (see curl #2 above).
2) On the runner host, download and verify the runner binary matching the architecture.
3) Configure the runner with the token:
   - ./config.sh --url https://github.com/SBS-GIVC/sbs --token <REGISTRATION_TOKEN>
4) Start the runner service or process:
   - ./run.sh (or install as a service if desired)
5) Verify registration:
   - Call “List self-hosted runners for a repository” and confirm the runner appears and is online.
6) (Optional) Add custom labels using the labels endpoint to target jobs.
7) (Optional) Update workflows to use label-based runs-on targeting.
8) If removing/replacing the runner:
   - Create a remove token (curl #3), then run ./config.sh remove --token <REMOVE_TOKEN>
   - Or delete the runner by ID via the REST API (curl #8).

Usage instructions for scripts/setup_sbs_runner.sh
1) Make it executable:
   - chmod +x scripts/setup_sbs_runner.sh
2) Export required token (needs repo/admin access):
   - export GH_TOKEN="<YOUR-TOKEN>"
3) (Optional) Override defaults:
   - export RUNNER_NAME="brainsait-pi"
   - export RUNNER_LABELS="brainsait-pi,arm64"
   - export RUNNER_ARCH="linux-arm64"
   - export WORKDIR="$HOME/actions-runner"
   - export START_RUNNER=1
4) Run the script:
   - ./scripts/setup_sbs_runner.sh
5) Start the runner later if you didn’t auto-start:
   - cd "$HOME/actions-runner" && ./run.sh
