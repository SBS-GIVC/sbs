import{r as l,u as K,j as e}from"./ui-core-CJgDYHCE.js";import{a as _}from"./nphies-DfCKYkM-.js";import{a as k}from"./ai-features-DQve4Ov2.js";import{S as Z,C as x,b as w,a as u,B as m}from"./analytics-BU3FKnFC.js";function ce(){const[d,f]=l.useState(1),[a,n]=l.useState({patientId:"",patientName:"",userEmail:"",facilityId:"FAC001",policyNumber:"",serviceDate:new Date().toISOString().split("T")[0],claimType:"institutional",diagnoses:[],items:[]}),[r,p]=l.useState({sbsCode:"",description:"",quantity:1,unitPrice:0}),[S,y]=l.useState([]),[z,j]=l.useState(!1),[q,C]=l.useState(!1),[I,v]=l.useState(null),[ee,O]=l.useState(null),[P,F]=l.useState(null),[se,H]=l.useState([]),[c,A]=l.useState(null),[b,R]=l.useState(!1),[$,D]=l.useState(!1),[U,E]=l.useState(!1),[T,L]=l.useState(null),[te,ae]=l.useState(null),o=K(),M=async()=>{if(!a.patientId){o.warning("Please enter patient ID");return}D(!0);try{const s=await _.checkEligibility({patientId:a.patientId,insurerId:"INS-AUTO",policyNumber:a.policyNumber||`POL-${a.patientId}`,serviceDate:a.serviceDate});O(s),n(t=>({...t,policyNumber:s.policyNumber})),s.eligible?(o.success("Patient eligibility verified"),f(2)):o.error("Patient coverage not active")}catch{o.error("Verification failed")}finally{D(!1)}},G=l.useCallback(async s=>{if(p(t=>({...t,sbsCode:s})),s.length>=2){C(!0);try{const t=await k.smartSearch(s,{limit:10,includeAI:!0});y(t.results),j(!0),t.aiInsights&&v(t.aiInsights)}catch{const i=k.localSearch(s,null,10);y(i),j(!0)}finally{C(!1)}}else y([]),j(!1),v(null)},[]),J=s=>{p({sbsCode:s.code,description:s.desc,quantity:1,unitPrice:s.fee||250}),j(!1),v(null)},Q=()=>{if(!r.sbsCode)return;const s={...r,sequence:a.items.length+1,netPrice:r.quantity*r.unitPrice},t=[...a.items,s];n(i=>({...i,items:t})),p({sbsCode:"",description:"",quantity:1,unitPrice:0}),B(t),X(s),V(t)},W=s=>{const t=a.items.filter((i,g)=>g!==s);n(i=>({...i,items:t})),B(t),t.length>0?V(t):A(null)},B=s=>{const t=s.map(g=>g.sbsCode),i=_.detectBundles(t);F(i.hasApplicableBundles?i:null)},X=s=>{const t=["49518","38200","39703","38218","30443","30571"],i=s.sbsCode.split("-")[0];(t.includes(i)||s.unitPrice>5e3)&&H(g=>[...g,s.sbsCode])},V=async s=>{R(!0);try{const t=await k.validateClaim({...a,items:s});A(t)}finally{R(!1)}},N=()=>a.bundleApplied&&P?.recommendedBundle?P.recommendedBundle.totalPrice:a.items.reduce((s,t)=>s+t.netPrice,0),Y=async()=>{E(!0);try{const t=await(await fetch("/api/submit-claim",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({claim:{...a,totalAmount:N()}})})).json();L(t),f(4),o.success("Claim submitted successfully")}catch{o.error("Submission failed")}finally{E(!1)}},h=s=>new Intl.NumberFormat("en-SA",{style:"currency",currency:"SAR",minimumFractionDigits:0}).format(s);return e.jsx("div",{className:"flex-1 overflow-y-auto bg-grid scrollbar-hide",children:e.jsxs("main",{className:"max-w-[1400px] mx-auto p-6 sm:p-8 space-y-8 stagger-children",children:[e.jsxs("section",{className:"animate-premium-in",children:[e.jsx(Z,{title:"Smart Claim Builder",subtitle:"Autonomous billing engine with real-time NPHIES compliance and AI code optimization.",badge:"AI-V4 Powered"}),e.jsxs("div",{className:"mt-10 mb-2 relative flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx("div",{className:"absolute top-1/2 left-0 right-0 h-1 bg-slate-200 dark:bg-slate-800 -translate-y-1/2 rounded-full"}),e.jsx("div",{className:"absolute top-1/2 left-0 h-1 bg-blue-600 -translate-y-1/2 rounded-full transition-all duration-700",style:{width:`${(d-1)/3*100}%`}}),[{n:1,icon:"person_search",label:"Identity"},{n:2,icon:"add_task",label:"Services"},{n:3,icon:"fact_check",label:"Review"},{n:4,icon:"check_circle",label:"Relayed"}].map(s=>e.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-2",children:[e.jsx("div",{className:`size-12 rounded-2xl flex items-center justify-center transition-all duration-500 shadow-xl ${d>=s.n?"bg-blue-600 text-white scale-110 shadow-blue-600/20":"bg-white dark:bg-slate-800 text-slate-400"}`,children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:s.icon})}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${d>=s.n?"text-blue-600":"text-slate-400"}`,children:s.label})]},s.n))]})]}),e.jsxs("div",{className:"min-h-[600px]",children:[d===1&&e.jsxs(x,{className:"max-w-4xl mx-auto animate-premium-in shadow-2xl",children:[e.jsx(w,{title:"Patient & Payer Context",subtitle:"Verified identities against national databases minimize claim rejection."}),e.jsxs(u,{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:"Universal Patient ID"}),e.jsxs("div",{className:"relative group",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600",children:"fingerprint"}),e.jsx("input",{type:"text",className:"w-full pl-12 pr-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20",placeholder:"Enter Saudi ID / Iqama",value:a.patientId,onChange:s=>n({...a,patientId:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:"Patient Full Name"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20",placeholder:"e.g. Fadil Ahmad",value:a.patientName,onChange:s=>n({...a,patientName:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:"Contact Email"}),e.jsx("input",{type:"email",className:"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20",placeholder:"billing-notifications@provider.com",value:a.userEmail,onChange:s=>n({...a,userEmail:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:"Service Date"}),e.jsx("input",{type:"date",className:"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20",value:a.serviceDate,onChange:s=>n({...a,serviceDate:s.target.value})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:"Claim Type"}),e.jsxs("select",{className:"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20 appearance-none pointer-events-auto",value:a.claimType,onChange:s=>n({...a,claimType:s.target.value}),children:[e.jsx("option",{value:"institutional",children:"Institutional"}),e.jsx("option",{value:"professional",children:"Professional"}),e.jsx("option",{value:"pharmacy",children:"Pharmacy"}),e.jsx("option",{value:"vision",children:"Vision"})]})]})]})]}),e.jsx("div",{className:"md:col-span-2 pt-6 border-t border-slate-100 dark:border-slate-800",children:e.jsx(m,{loading:$,icon:"verified",onClick:M,className:"w-full py-4 rounded-2xl",children:"Validate Identity & Continue"})})]})]}),d===2&&e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8 animate-premium-in",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(x,{children:[e.jsx(w,{title:"Service Orchestration",subtitle:"Add procedures, pharmaceuticals, or disposables to this claim session."}),e.jsxs(u,{className:"space-y-6",children:[e.jsxs("div",{className:"relative space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:"SBS Code / Service Description"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",children:"search"}),e.jsx("input",{type:"text",className:"w-full pl-12 pr-12 py-4 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20",placeholder:"Search by code or describe in natural language...",value:r.sbsCode,onChange:s=>G(s.target.value)}),q&&e.jsx("span",{className:"material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 animate-spin text-blue-600",children:"progress_activity"})]}),z&&S.length>0&&e.jsxs("div",{className:"absolute z-50 w-full mt-2 glass-panel border border-slate-200/50 dark:border-slate-700/50 rounded-2xl shadow-2xl max-h-72 overflow-y-auto overflow-x-hidden",children:[I&&e.jsxs("div",{className:"px-5 py-2.5 bg-blue-600 font-bold text-white text-[11px] flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"auto_awesome"})," ",I]}),S.map((s,t)=>e.jsxs("div",{onClick:()=>J(s),className:"px-5 py-4 hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer border-b border-slate-100 dark:border-slate-800 last:border-0 group/item transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"font-mono text-sm font-bold text-blue-600 bg-blue-600/10 px-2 py-0.5 rounded",children:s.code}),e.jsx("span",{className:"text-[10px] font-black uppercase text-slate-400",children:s.category})]}),e.jsx("p",{className:"mt-1 text-sm font-bold text-slate-700 dark:text-slate-200",children:s.desc})]},t))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:"Quantity"}),e.jsx("input",{type:"number",className:"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold",value:r.quantity,onChange:s=>p({...r,quantity:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:"Unit Price (Estimated)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold",children:"SAR"}),e.jsx("input",{type:"number",className:"w-full pl-14 pr-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold",value:r.unitPrice,onChange:s=>p({...r,unitPrice:Number(s.target.value)})})]})]})]}),e.jsx(m,{variant:"secondary",className:"w-full py-4 rounded-2xl border-dashed",onClick:Q,icon:"add_box",children:"Add to Session"})]})]}),a.items.length>0&&e.jsxs(x,{children:[e.jsx(w,{title:"Session Payload",action:e.jsx("span",{className:"text-xl font-black text-blue-600",children:h(N())})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500",children:"Service Info"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500 text-right",children:"Net Price"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:a.items.map((s,t)=>e.jsxs("tr",{className:"group hover:bg-slate-50/50 dark:hover:bg-slate-800/20 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-xs font-black bg-blue-600/10 text-blue-600 px-2 py-0.5 rounded",children:s.sbsCode}),e.jsx("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-200",children:s.description})]}),e.jsxs("p",{className:"text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest",children:[s.quantity," Unit Ã— ",h(s.unitPrice)]})]}),e.jsx("td",{className:"px-6 py-4 text-right font-black text-slate-900 dark:text-white",children:h(s.netPrice)}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>W(t),className:"p-2 text-slate-300 hover:text-rose-500 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})})]},t))})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[(c||b)&&e.jsx(x,{className:`border-l-4 transition-colors ${b?"border-l-blue-600 animate-pulse":c?.errors?.length>0?"border-l-rose-500":"border-l-emerald-500 shadow-emerald-500/10"}`,children:e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`material-symbols-outlined font-black ${b?"text-blue-600":c?.errors?.length>0?"text-rose-500":"text-emerald-500"}`,children:b?"sync":c?.errors?.length>0?"report":"verified"}),e.jsx("h4",{className:"text-sm font-black uppercase tracking-widest text-slate-900 dark:text-white",children:"AI Compliance Agent"})]}),c?.errors?.map((s,t)=>e.jsxs("div",{className:"p-3 bg-rose-500/10 border border-rose-500/20 rounded-xl text-xs font-bold text-rose-600 flex gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})," ",s]},t)),c?.warnings?.map((s,t)=>e.jsxs("div",{className:"p-3 bg-amber-500/10 border border-amber-500/20 rounded-xl text-xs font-bold text-amber-600 flex gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"warning"})," ",s]},t)),c?.suggestions?.map((s,t)=>e.jsxs("div",{className:"p-4 glass-panel border border-blue-600/20 rounded-2xl space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-600 text-sm",children:"auto_awesome"}),e.jsx("p",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 leading-relaxed",children:s.reason||s.name})]}),e.jsx("button",{onClick:()=>o.info("Optimizing..."),className:"w-full py-2 bg-blue-600 text-white text-[10px] font-black uppercase tracking-widest rounded-lg shadow-lg shadow-blue-600/20 transition-transform active:scale-95",children:"Optimize with Agent"})]},t)),!b&&!c?.errors?.length&&a.items.length>0&&e.jsx("div",{className:"text-center py-4 bg-emerald-500/5 rounded-2xl border border-emerald-500/10",children:e.jsx("p",{className:"text-xs font-black text-emerald-600 uppercase tracking-widest",children:"Compliance Guaranteed"})})]})}),e.jsx(x,{className:"bg-slate-900 text-white shadow-2xl",children:e.jsxs(u,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Total Adjudicated Amount"}),e.jsx("h3",{className:"text-4xl font-black tracking-tighter text-blue-500",children:h(N())})]}),e.jsxs("div",{className:"space-y-3 pt-6 border-t border-white/10",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold text-slate-400",children:[e.jsx("span",{children:"Patient Coverage"}),e.jsx("span",{className:"text-emerald-500",children:"92% Cover"})]}),e.jsxs("div",{className:"flex justify-between text-xs font-bold text-slate-400",children:[e.jsx("span",{children:"Taxes / VAT"}),e.jsx("span",{children:"SAR 0.00"})]})]}),e.jsx(m,{className:"w-full py-4 rounded-2xl",onClick:()=>f(3),children:"Proceed to Review"})]})})]})]}),d===3&&e.jsxs(x,{className:"max-w-3xl mx-auto animate-premium-in shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-12 text-center space-y-6 bg-slate-900 text-white",children:[e.jsx("div",{className:"size-20 bg-blue-600 rounded-[28px] flex items-center justify-center mx-auto shadow-2xl shadow-blue-600/40",children:e.jsx("span",{className:"material-symbols-outlined text-4xl",children:"fact_check"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-4xl font-black tracking-tighter",children:"Final Verification"}),e.jsx("p",{className:"text-slate-400 font-bold uppercase tracking-widest text-xs",children:"Review the operational payload before national relay"})]})]}),e.jsxs(u,{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 pb-8 border-b border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-400",children:"Relaying to"}),e.jsx("p",{className:"text-lg font-black text-slate-800 dark:text-white",children:"NPHIES Production"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-400",children:"Claim Value"}),e.jsx("p",{className:"text-lg font-black text-blue-600",children:h(N())})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-400 text-center",children:"Security Check"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-emerald-500",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"shield"})," Digital Signature Ready"]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-emerald-500",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"lock"})," RSA-2048 Active"]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(m,{variant:"secondary",className:"flex-1 py-4",onClick:()=>f(2),children:"Modify Session"}),e.jsx(m,{loading:U,icon:"bolt",className:"flex-[2] py-4",onClick:Y,children:"Sign & Submit to NPHIES"})]})]})]}),d===4&&e.jsxs("div",{className:"max-w-2xl mx-auto text-center space-y-8 animate-premium-in py-12",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"size-32 bg-emerald-500 rounded-[40px] flex items-center justify-center mx-auto shadow-2xl shadow-emerald-500/20 scale-110",children:e.jsx("span",{className:"material-symbols-outlined text-6xl text-white",children:"verified"})}),e.jsx("div",{className:"absolute inset-x-0 bottom-[-10px] flex justify-center",children:e.jsx("span",{className:"px-4 py-1.5 bg-slate-900 border border-slate-800 text-white rounded-full text-[10px] font-black uppercase tracking-widest shadow-xl",children:"Transmission Success"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-4xl font-black tracking-tighter text-slate-900 dark:text-white",children:"Claim Successfully Relayed"}),e.jsx("p",{className:"text-slate-500 font-bold max-w-sm mx-auto leading-relaxed",children:"Your claim has been normalized, signed and accepted by the national integration gateway."})]}),e.jsx(x,{className:"bg-slate-50 dark:bg-slate-900/40 border-slate-200/50 dark:border-slate-800/50",children:e.jsxs(u,{className:"space-y-4 text-left",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm font-bold",children:[e.jsx("span",{className:"text-slate-400 uppercase tracking-widest text-[10px]",children:"Reference ID"}),e.jsx("code",{className:"text-blue-600 font-mono",children:T?.claimId||"CLM-88234-X"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm font-bold",children:[e.jsx("span",{className:"text-slate-400 uppercase tracking-widest text-[10px]",children:"Relay Status"}),e.jsx("span",{className:"text-emerald-500 uppercase",children:"Accepted"})]})]})}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[e.jsx(m,{icon:"receipt",onClick:()=>window.open(T?.trackingUrl,"_blank"),children:"Download NPHIES Receipt"}),e.jsx(m,{variant:"secondary",icon:"refresh",onClick:()=>window.location.reload(),children:"Build Another Claim"})]})]})]})]})})}export{ce as ClaimBuilderPage};
//# sourceMappingURL=ClaimBuilderPage-DyIBnjjl.js.map
