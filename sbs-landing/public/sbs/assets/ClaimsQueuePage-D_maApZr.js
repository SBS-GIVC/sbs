import{r as u,j as e}from"./vendor-react-MVSD7VGK.js";import{i as U,u as Q}from"./main-DTZYqsTu.js";import{B as k}from"./Button-BDY0gMZ-.js";import{C as F,b as M,a as J}from"./Card-CNl4AdZD.js";import{I as V}from"./Input-OxrVsoY9.js";import{S as Z}from"./SectionHeader-BFZqpzku.js";import"./vendor-BW1Bdpst.js";const I=typeof window<"u"&&typeof window.SBS_API_URL=="string"&&window.SBS_API_URL.trim()?window.SBS_API_URL.replace(/\/+$/,""):"";function ae({lang:a="en"}){const g=U[a]||U.en,r=g.pages?.claimsQueue||U.en.pages.claimsQueue,[p,x]=u.useState("all"),[c,f]=u.useState(""),[m,h]=u.useState([]),[y,v]=u.useState(!0),[o,P]=u.useState(null),[w,O]=u.useState(!0),[D,C]=u.useState({}),b=Q(),$=u.useCallback((t,s)=>{const i=String(t||"processing").toLowerCase();if(["failed","rejected"].includes(i))return"rejected";if(["approved","completed","submitted"].includes(i))return"relayed";const l=Number(s||0);return i==="processing"&&l<=25?"pending":"processing"},[]),L=u.useCallback(t=>{const s=t.progress||{},i=Number(s.percentage||0),l=String(t.status||"processing").toLowerCase(),d=Number.isFinite(Number(t.aiRiskScore))?Number(t.aiRiskScore):null,n=["failed","rejected"].includes(l)||d!==null&&d>=80?"urgent":d!==null&&d>=60?"elevated":"normal";return{id:t.claimId,patient:t.patientName||t.patientId||"Unknown Patient",patientId:t.patientId||null,facility:t.facilityId||"Main Hub",type:t.claimType?`${String(t.claimType).slice(0,1).toUpperCase()}${String(t.claimType).slice(1)}`:"Institutional",submittedAt:t.createdAt,lastUpdate:t.lastUpdate,status:l,bucket:$(l,i),progressPercentage:i,currentStage:s.currentStage||null,itemsCount:Number(t.itemsCount||0),amount:Math.max(0,Number(t.totalAmount||0)),aiRiskScore:d,routeUsed:t.routeUsed||null,trackingUrl:t.trackingUrl||null,priority:n}},[$]),S=u.useCallback(async({silent:t=!1}={})=>{t||v(!0);try{const s=await fetch(`${I}/api/claims?limit=50&page=1`),i=await s.json().catch(()=>({}));if(!s.ok||i.success===!1)throw new Error(i.error||`HTTP ${s.status}`);const l=(i.claims||[]).map(L);h(l),P(null)}catch(s){h([]),P(s?.message||"Failed to resolve claims repository")}finally{t||v(!1)}},[L]);u.useEffect(()=>{S()},[]),u.useEffect(()=>{if(!w)return;const t=setInterval(()=>S({silent:!0}),15e3);return()=>clearInterval(t)},[w,S]);const j=u.useMemo(()=>({all:m.length,pending:m.filter(t=>t.bucket==="pending").length,processing:m.filter(t=>t.bucket==="processing").length,relayed:m.filter(t=>t.bucket==="relayed").length,rejected:m.filter(t=>t.bucket==="rejected").length}),[m]),R=m.filter(t=>{const s=p==="all"||t.bucket===p,i=c===""||t.id.toLowerCase().includes(c.toLowerCase())||t.patient.toLowerCase().includes(c.toLowerCase())||String(t.facility).toLowerCase().includes(c.toLowerCase())||String(t.patientId||"").toLowerCase().includes(c.toLowerCase());return s&&i}),E=t=>new Intl.NumberFormat("en-SA",{style:"currency",currency:"SAR",minimumFractionDigits:0}).format(t),_=async t=>{const s=String(t||"");if(s){C(i=>({...i,[s]:!0}));try{const i=await fetch(`${I}/api/claim-status/${encodeURIComponent(s)}`),l=await i.json().catch(()=>({}));if(!i.ok||l.success===!1)throw new Error(l.error||l.message||`HTTP ${i.status}`);h(d=>d.map(n=>{if(n.id!==s)return n;const T=Number(l.progress?.percentage||n.progressPercentage||0),A=String(l.status||n.status||"processing").toLowerCase();return{...n,status:A,progressPercentage:T,currentStage:l.progress?.currentStage||n.currentStage,lastUpdate:l.timestamps?.lastUpdate||n.lastUpdate,trackingUrl:l.trackingUrl||n.trackingUrl,bucket:$(A,T)}})),b.success(r.toast.statusRefreshed)}catch(i){b.error(i?.message||r.toast.statusRefreshFailed)}finally{C(i=>({...i,[s]:!1}))}}},q=async t=>{const s=String(t||"");if(s){C(i=>({...i,[s]:!0}));try{const i=await fetch(`${I}/api/claims/${encodeURIComponent(s)}/retry`,{method:"POST",headers:{"Content-Type":"application/json"}}),l=await i.json().catch(()=>({}));if(!i.ok||l.success===!1)throw new Error(l.error||l.message||`HTTP ${i.status}`);b.success(r.toast.retryInitiated),await _(s)}catch(i){b.error(i?.message||r.toast.retryFailed)}finally{C(i=>({...i,[s]:!1}))}}},B=t=>{const s=t?.trackingUrl||`/tracking.html?claimId=${encodeURIComponent(t?.id||"")}`;s&&window.open(s,"_blank","noopener,noreferrer")},z=t=>{const s=String(t||"");s&&window.open(`${I}/api/claim-receipt/${encodeURIComponent(s)}`,"_blank","noopener,noreferrer")},H=async t=>{const s=String(t||"");if(s)try{await navigator.clipboard.writeText(s),b.success(r.toast.claimIdCopied)}catch{b.error(r.toast.copyFailed)}};return e.jsx("div",{className:"flex-1",children:e.jsxs("main",{className:"max-w-[1400px] mx-auto p-6 sm:p-8 space-y-8 stagger-children",children:[e.jsxs("section",{className:"animate-premium-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6",children:[e.jsx(Z,{title:r.header.title,subtitle:r.header.subtitle,badge:r.header.badge}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{variant:"secondary",icon:w?"pause_circle":"play_circle",onClick:()=>O(t=>!t),"data-testid":"claimsqueue-autorefresh",children:w?r.actions.autoRefreshOn:r.actions.autoRefreshOff}),e.jsx(k,{variant:"secondary",icon:"refresh",loading:y,onClick:()=>S(),"data-testid":"claimsqueue-refresh",children:r.actions.refresh}),e.jsx(k,{icon:"add_card",onClick:()=>window.dispatchEvent(new CustomEvent("sbs:navigate",{detail:{view:"claim-builder"}})),children:r.actions.create})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 mt-8",children:[e.jsx(N,{label:r.filters.all,count:j.all,active:p==="all",onClick:()=>x("all"),icon:"inventory_2",color:"blue"}),e.jsx(N,{label:r.filters.pending,count:j.pending,active:p==="pending",onClick:()=>x("pending"),icon:"pending",color:"amber"}),e.jsx(N,{label:r.filters.processing,count:j.processing,active:p==="processing",onClick:()=>x("processing"),icon:"sync",color:"indigo"}),e.jsx(N,{label:r.filters.relayed,count:j.relayed,active:p==="relayed",onClick:()=>x("relayed"),icon:"verified",color:"emerald"}),e.jsx(N,{label:r.filters.rejected,count:j.rejected,active:p==="rejected",onClick:()=>x("rejected"),icon:"report",color:"rose"})]})]}),e.jsx(F,{className:"animate-premium-in",style:{animationDelay:"100ms"},children:e.jsxs(M,{className:"flex flex-col sm:flex-row gap-4 items-end",children:[e.jsx("div",{className:"flex-1",children:e.jsx(V,{label:r.search.label,icon:"search",placeholder:r.search.placeholder,"data-testid":"claimsqueue-search",value:c,onChange:t=>f(t.target.value)})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"secondary",icon:"filter_list",onClick:()=>b.info(r.actions.advanced),children:r.actions.advanced}),e.jsx(k,{variant:"secondary",icon:"download",onClick:()=>{const t=R.map(n=>[n.id,n.patient,n.facility,n.status,n.amount]),s=[["Claim ID","Patient","Facility","Status","Amount"],...t].map(n=>n.join(",")).join(`
`),i=new Blob([s],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(i),d=document.createElement("a");d.href=l,d.download=`claims-queue-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l),b.success(r.toast.exportOk)},children:r.actions.export})]})]})}),e.jsxs(F,{className:"animate-premium-in",style:{animationDelay:"200ms"},children:[e.jsx(J,{title:"Operational Payload",subtitle:"Detailed view of active claims in the current relay cycle.",action:e.jsxs("span",{className:"text-[10px] font-black uppercase text-slate-400",children:["Total Visible: ",R.length]})}),e.jsxs("div",{className:"overflow-x-auto",children:[y?e.jsxs("div",{className:"py-24 flex flex-col items-center justify-center space-y-4",children:[e.jsx("div",{className:"size-12 rounded-full border-4 border-blue-600/10 border-t-blue-600 animate-spin"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:g.common.loading})]}):o?e.jsx("div",{className:"py-24 text-center",children:e.jsx("p",{className:"text-rose-500 font-bold",children:o})}):e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500",children:"Claim Identifier"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500",children:"Patient Detail"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500",children:"Source Facility"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500 text-right",children:"Value (SAR)"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500",children:"Status"}),e.jsx("th",{className:"px-6 py-4"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:R.map((t,s)=>e.jsx(G,{claim:t,formatCurrency:E,busy:!!D[t.id],onRefresh:()=>_(t.id),onRetry:()=>q(t.id),onOpenTracking:()=>B(t),onOpenReceipt:()=>z(t.id),onCopyId:()=>H(t.id)},t.id))})]}),!y&&R.length===0&&e.jsxs("div",{className:"py-32 flex flex-col items-center justify-center space-y-4",children:[e.jsx("div",{className:"size-20 bg-slate-50 dark:bg-slate-800 rounded-[32px] flex items-center justify-center text-slate-300",children:e.jsx("span",{className:"material-symbols-outlined text-4xl",children:"inbox_customize"})}),e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"No matching results found"})]})]})]})]})})}function N({label:a,count:g,active:r,onClick:p,icon:x,color:c}){const f={blue:"text-blue-600 border-blue-600/30 bg-blue-600/5",amber:"text-amber-600 border-amber-600/30 bg-amber-600/5",indigo:"text-indigo-600 border-indigo-600/30 bg-indigo-600/5",emerald:"text-emerald-600 border-emerald-600/30 bg-emerald-600/5",rose:"text-rose-600 border-rose-600/30 bg-rose-600/5"};return e.jsxs("button",{type:"button",onClick:p,className:`p-5 rounded-[24px] border-2 text-left transition-all duration-300 group ${r?`${f[c]} shadow-xl shadow-slate-900/5 scale-[1.02]`:"border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900/50 hover:border-slate-200 dark:hover:border-slate-700"} focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("span",{"aria-hidden":"true",className:`material-symbols-outlined text-xl transition-transform group-hover:scale-110 ${r?f[c].split(" ")[0]:"text-slate-400"}`,children:x}),e.jsx("span",{className:`text-2xl font-black ${r?f[c].split(" ")[0]:"text-slate-900 dark:text-white"}`,children:g})]}),e.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest ${r?f[c].split(" ")[0]:"text-slate-400"}`,children:a})]})}function G({claim:a,formatCurrency:g,busy:r=!1,onRefresh:p,onRetry:x,onOpenTracking:c,onOpenReceipt:f,onCopyId:m}){const h={pending:{label:"Pending Adjudication",color:"text-amber-600 bg-amber-600/10"},processing:{label:"Integrating...",color:"text-blue-600 bg-blue-600/10"},submitted:{label:"Relayed to NPHIES",color:"text-indigo-600 bg-indigo-600/10"},approved:{label:"Adjudicated",color:"text-emerald-600 bg-emerald-600/10"},completed:{label:"Settled",color:"text-emerald-600 bg-emerald-600/10"},rejected:{label:"Error Detected",color:"text-rose-600 bg-rose-600/10 text-[9px]"},failed:{label:"Relay Failed",color:"text-rose-600 bg-rose-600/10"}},y=h[a.status]||h.processing,v=a.aiRiskScore===null?null:a.aiRiskScore>=80?{label:"High Risk",cls:"bg-rose-500/10 text-rose-600 border-rose-500/20"}:a.aiRiskScore>=60?{label:"Review",cls:"bg-amber-500/10 text-amber-700 border-amber-500/20"}:{label:"Low Risk",cls:"bg-emerald-500/10 text-emerald-700 border-emerald-500/20"};return e.jsxs("tr",{"data-testid":`claimsqueue-row-${a.id}`,className:"group hover:bg-slate-50/50 dark:hover:bg-slate-800/20 transition-all duration-300",children:[e.jsx("td",{className:"px-6 py-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`size-2 rounded-full ${a.priority==="urgent"?"bg-rose-500 animate-pulse":"bg-slate-200 dark:bg-slate-700"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{"data-testid":`claimsqueue-claimid-${a.id}`,className:"font-mono text-sm font-black text-blue-600 bg-blue-600/5 px-2 py-0.5 rounded tracking-tight w-fit",children:a.id}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:Number.isFinite(Number(a.progressPercentage))?`${Math.round(Number(a.progressPercentage))}%`:"--"}),a.currentStage&&e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400",children:String(a.currentStage).replace(/([A-Z])/g," $1").trim()}),!!a.itemsCount&&e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400",children:["items:",a.itemsCount]})]})]})]})}),e.jsx("td",{className:"px-6 py-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-bold text-slate-800 dark:text-gray-100",children:a.patient}),e.jsxs("span",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest",children:[a.type," Case"]}),a.patientId&&e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400",children:a.patientId})]})}),e.jsx("td",{className:"px-6 py-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500",children:a.facility}),a.routeUsed&&e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:["route:",a.routeUsed]})]})}),e.jsx("td",{className:"px-6 py-5 text-right",children:e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{"data-testid":`claimsqueue-amount-${a.id}`,className:"text-sm font-black text-slate-900 dark:text-white tracking-tight",children:g(a.amount)}),v&&e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full border text-[9px] font-black uppercase tracking-widest ${v.cls}`,title:"AI pre-submit risk (server-side)",children:[v.label," ",a.aiRiskScore]})]})}),e.jsx("td",{className:"px-6 py-5",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest border border-current opacity-90 ${y.color}`,children:y.label})}),e.jsx("td",{className:"px-6 py-5 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button","data-testid":`claimsqueue-copy-${a.id}`,className:"size-9 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-300 hover:text-slate-900 dark:hover:text-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900",title:"Copy Claim ID","aria-label":"Copy claim ID",disabled:r,onClick:o=>{o.preventDefault(),o.stopPropagation(),m?.()},children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-[20px]",children:"content_copy"})}),e.jsx("button",{type:"button","data-testid":`claimsqueue-receipt-${a.id}`,className:"size-9 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-300 hover:text-indigo-600 transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900",title:"Open Receipt JSON","aria-label":"Open receipt JSON",disabled:r,onClick:o=>{o.preventDefault(),o.stopPropagation(),f?.()},children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-[20px]",children:"receipt_long"})}),e.jsx("button",{type:"button","data-testid":`claimsqueue-track-${a.id}`,className:"size-9 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-300 hover:text-emerald-600 transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900",title:"Open Tracking","aria-label":"Open tracking",disabled:r,onClick:o=>{o.preventDefault(),o.stopPropagation(),c?.()},children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-[20px]",children:"travel_explore"})}),e.jsx("button",{type:"button","data-testid":`claimsqueue-refresh-${a.id}`,className:"size-9 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-300 hover:text-blue-600 transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900",title:"Refresh Status","aria-label":"Refresh status",disabled:r,onClick:o=>{o.preventDefault(),o.stopPropagation(),p?.()},children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-[20px]",children:"sync"})}),e.jsx("button",{type:"button","data-testid":`claimsqueue-retry-${a.id}`,className:`size-9 rounded-xl transition-all ${["failed","rejected"].includes(String(a.status||"").toLowerCase())?"hover:bg-rose-500/10 text-slate-300 hover:text-rose-600":"opacity-40 cursor-not-allowed text-slate-300"} focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900`,title:"Retry Failed Claim","aria-label":"Retry failed claim",disabled:r||!["failed","rejected"].includes(String(a.status||"").toLowerCase()),onClick:o=>{o.preventDefault(),o.stopPropagation(),x?.()},children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-[20px]",children:"refresh"})})]})})]})}export{ae as ClaimsQueuePage};
//# sourceMappingURL=ClaimsQueuePage-D_maApZr.js.map
