{"version":3,"file":"AdminAuditPage-9vBUp6nd.js","sources":["../../src/pages/AdminAuditPage.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { i18n } from '../utils/i18n';\nimport { Card, CardBody, CardHeader } from '../components/ui/Card';\nimport { SectionHeader } from '../components/ui/SectionHeader';\nimport { Button } from '../components/ui/Button';\nimport { Input } from '../components/ui/Input';\nimport { useToast } from '../components/Toast';\n\nconst API_BASE_URL =\n  (typeof window !== 'undefined' && typeof window.SBS_API_URL === 'string' && window.SBS_API_URL.trim())\n    ? window.SBS_API_URL.replace(/\\/+$/, '')\n    : '';\n\nexport function AdminAuditPage({ lang = 'en' }) {\n  const copy = i18n[lang] || i18n.en;\n  const t = copy.pages?.adminAudit || i18n.en.pages.adminAudit;\n  const toast = useToast();\n\n  const [token, setToken] = useState(() => {\n    if (typeof window === 'undefined') return '';\n    try { return window.sessionStorage.getItem('sbs_admin_token') || ''; } catch { return ''; }\n  });\n  const [loading, setLoading] = useState(false);\n  const [events, setEvents] = useState([]);\n  const [error, setError] = useState(null);\n\n  const authHeaders = useMemo(() => {\n    const headers = {};\n    const trimmed = String(token || '').trim();\n    if (trimmed) headers.Authorization = trimmed.startsWith('Bearer ') ? trimmed : `Bearer ${trimmed}`;\n    return headers;\n  }, [token]);\n\n  const loadEvents = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      if (typeof window !== 'undefined') {\n        try { window.sessionStorage.setItem('sbs_admin_token', token || ''); } catch {}\n      }\n\n      const res = await fetch(`${API_BASE_URL}/api/admin/audit?limit=200`, {\n        headers: { ...authHeaders }\n      });\n      const data = await res.json().catch(() => ({}));\n      if (!res.ok || data.success === false) {\n        throw new Error(data.error || data.message || `HTTP ${res.status}`);\n      }\n      setEvents(Array.isArray(data.events) ? data.events : []);\n    } catch (e) {\n      setEvents([]);\n      setError(e?.message || 'Failed to load audit events');\n      toast.error(e?.message || 'Failed to load audit events');\n    } finally {\n      setLoading(false);\n    }\n  }, [authHeaders, token, toast]);\n\n  useEffect(() => {\n    loadEvents();\n  }, [loadEvents]);\n\n  return (\n    <div className=\"flex-1\">\n      <main className=\"max-w-[1400px] mx-auto p-6 sm:p-8 space-y-8 stagger-children\">\n        <section className=\"animate-premium-in\">\n          <SectionHeader title={t.title} subtitle={t.subtitle} badge={t.badge} />\n        </section>\n\n        <Card>\n          <CardHeader title={t.tokenLabel} subtitle={null} />\n          <CardBody className=\"flex flex-col sm:flex-row gap-3 items-end\">\n            <div className=\"flex-1\">\n              <Input\n                label={t.tokenLabel}\n                placeholder={t.tokenPlaceholder}\n                value={token}\n                onChange={(e) => setToken(e.target.value)}\n              />\n            </div>\n            <Button\n              icon=\"refresh\"\n              loading={loading}\n              onClick={loadEvents}\n              data-testid=\"auditlog-load\"\n            >\n              {t.load}\n            </Button>\n          </CardBody>\n        </Card>\n\n        <Card>\n          <CardHeader\n            title={t.title}\n            subtitle={error ? String(error) : null}\n            action={<span className=\"text-[10px] font-black uppercase text-slate-400\">{events.length}</span>}\n          />\n          <div className=\"overflow-x-auto\">\n            {loading ? (\n              <div className=\"py-24 flex flex-col items-center justify-center space-y-4\">\n                <div className=\"size-12 rounded-full border-4 border-blue-600/10 border-t-blue-600 animate-spin\"></div>\n                <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-400\">{copy.common.loading}</p>\n              </div>\n            ) : events.length === 0 ? (\n              <div className=\"py-24 text-center\">\n                <p className=\"text-slate-500 font-semibold\">{t.empty}</p>\n              </div>\n            ) : (\n              <table className=\"w-full text-left\">\n                <thead className=\"bg-slate-50 dark:bg-slate-900/40\">\n                  <tr>\n                    <th className=\"px-6 py-4 text-[10px] font-black uppercase text-slate-500\">{t.columns.time}</th>\n                    <th className=\"px-6 py-4 text-[10px] font-black uppercase text-slate-500\">{t.columns.type}</th>\n                    <th className=\"px-6 py-4 text-[10px] font-black uppercase text-slate-500\">{t.columns.actor}</th>\n                    <th className=\"px-6 py-4 text-[10px] font-black uppercase text-slate-500\">{t.columns.detail}</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800\">\n                  {events.map((evt) => (\n                    <tr key={evt.id} className=\"hover:bg-slate-50/50 dark:hover:bg-slate-800/20 transition-colors\">\n                      <td className=\"px-6 py-4 text-[11px] font-bold text-slate-600 dark:text-slate-300 whitespace-nowrap\">\n                        {evt.timestamp}\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <span className=\"inline-flex items-center px-2.5 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest bg-blue-600/10 text-blue-600 border border-blue-600/20\">\n                          {evt.eventType}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 text-[11px] font-semibold text-slate-600 dark:text-slate-300\">\n                        <div className=\"space-y-1\">\n                          <div className=\"font-mono text-[10px] text-slate-400\">{evt.actor?.ip || '—'}</div>\n                          <div className=\"truncate max-w-[240px]\">{evt.actor?.user || '—'}</div>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4 text-[11px] font-semibold text-slate-700 dark:text-slate-200\">\n                        <pre className=\"whitespace-pre-wrap text-[10px] font-mono text-slate-500 dark:text-slate-400 max-h-40 overflow-auto\">\n                          {JSON.stringify(evt.detail || {}, null, 2)}\n                        </pre>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            )}\n          </div>\n        </Card>\n      </main>\n    </div>\n  );\n}\n\n"],"names":["API_BASE_URL","AdminAuditPage","lang","copy","i18n","t","toast","useToast","token","setToken","useState","loading","setLoading","events","setEvents","error","setError","authHeaders","useMemo","headers","trimmed","loadEvents","useCallback","res","data","e","useEffect","jsxs","jsx","SectionHeader","Card","CardHeader","CardBody","Input","Button","evt"],"mappings":"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"}