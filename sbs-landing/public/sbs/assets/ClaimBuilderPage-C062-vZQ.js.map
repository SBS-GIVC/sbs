{"version":3,"file":"ClaimBuilderPage-C062-vZQ.js","sources":["../../src/pages/ClaimBuilderPage.jsx"],"sourcesContent":["import { useMemo, useRef, useState, useCallback, useEffect } from 'react';\nimport { nphiesService } from '../services/nphiesService';\nimport { aiAssistant } from '../services/aiAssistantService';\nimport { i18n } from '../utils/i18n';\nimport { useToast } from '../components/Toast';\nimport { Button } from '../components/ui/Button';\nimport { Card, CardBody, CardHeader } from '../components/ui/Card';\nimport { SectionHeader } from '../components/ui/SectionHeader';\n\n/**\n * Premium Smart Claim Builder\n * AI-powered claim creation with bundle detection, validation, and real-time assistance\n */\nexport function ClaimBuilderPage({ lang = 'en' }) {\n  const copy = i18n[lang] || i18n.en;\n  const t = copy.pages?.claimBuilder || i18n.en.pages.claimBuilder;\n  const [step, setStep] = useState(1);\n  const [claim, setClaim] = useState({\n    patientId: '',\n    patientName: '',\n    userEmail: '',\n    facilityId: 'FAC001',\n    policyNumber: '',\n    serviceDate: new Date().toISOString().split('T')[0],\n    claimType: 'institutional',\n    diagnoses: [],\n    items: [],\n    bundleApplied: false,\n    bundleId: null\n  });\n  const [currentItem, setCurrentItem] = useState({ sbsCode: '', description: '', quantity: 1, unitPrice: 0 });\n  const [sbsSuggestions, setSbsSuggestions] = useState([]);\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const [isSearching, setIsSearching] = useState(false);\n  const [aiInsights, setAiInsights] = useState(null);\n  const [eligibility, setEligibility] = useState(null);\n  const [bundleInfo, setBundleInfo] = useState(null);\n  const [priorAuthRequired, setPriorAuthRequired] = useState([]);\n  const [validation, setValidation] = useState(null);\n  const [isValidating, setIsValidating] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const [submissionResult, setSubmissionResult] = useState(null);\n  const [claimStatus, setClaimStatus] = useState(null);\n  const toast = useToast();\n  const [formAttempted, setFormAttempted] = useState({ identity: false, item: false });\n  const [touched, setTouched] = useState({\n    patientId: false,\n    userEmail: false,\n    itemSbsCode: false,\n    itemQuantity: false,\n    itemUnitPrice: false\n  });\n\n  const patientIdRef = useRef(null);\n  const userEmailRef = useRef(null);\n  const itemSbsCodeRef = useRef(null);\n\n  const validatePatientId = (value) => {\n    const v = String(value || '').trim();\n    if (!v) return t.validation.patientIdRequired;\n    if (!/^[0-9]{10}$/.test(v)) return t.validation.patientIdInvalid;\n    return null;\n  };\n\n  const validateEmail = (value) => {\n    const v = String(value || '').trim();\n    if (!v) return null;\n    if (!/^[^\\\\s@]+@[^\\\\s@]+\\\\.[^\\\\s@]+$/.test(v)) return t.validation.emailInvalid;\n    return null;\n  };\n\n  const validateItemSbsCode = (value) => {\n    const v = String(value || '').trim();\n    if (!v) return t.validation.itemCodeRequired;\n    if (v.length < 2) return lang === 'ar' ? 'ÿ£ÿØÿÆŸÑ ÿ≠ÿ±ŸÅŸäŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÑŸÑÿ®ÿ≠ÿ´.' : 'Enter at least 2 characters to search.';\n    return null;\n  };\n\n  const validateQuantity = (value) => {\n    const n = Number(value);\n    if (!Number.isFinite(n) || n <= 0) return t.validation.qtyInvalid;\n    return null;\n  };\n\n  const validateUnitPrice = (value) => {\n    const n = Number(value);\n    if (!Number.isFinite(n) || n <= 0) return t.validation.priceInvalid;\n    return null;\n  };\n\n  const fieldErrors = useMemo(() => {\n    return {\n      patientId: (formAttempted.identity || touched.patientId) ? validatePatientId(claim.patientId) : null,\n      userEmail: (formAttempted.identity || touched.userEmail) ? validateEmail(claim.userEmail) : null,\n      itemSbsCode: (formAttempted.item || touched.itemSbsCode) ? validateItemSbsCode(currentItem.sbsCode) : null,\n      itemQuantity: (formAttempted.item || touched.itemQuantity) ? validateQuantity(currentItem.quantity) : null,\n      itemUnitPrice: (formAttempted.item || touched.itemUnitPrice) ? validateUnitPrice(currentItem.unitPrice) : null,\n    };\n  }, [\n    formAttempted.identity,\n    formAttempted.item,\n    touched.patientId,\n    touched.userEmail,\n    touched.itemSbsCode,\n    touched.itemQuantity,\n    touched.itemUnitPrice,\n    claim.patientId,\n    claim.userEmail,\n    currentItem.sbsCode,\n    currentItem.quantity,\n    currentItem.unitPrice\n  ]);\n\n  const applyClaimContext = useCallback((ctx) => {\n    const code = String(ctx?.code || ctx?.sbsCode || ctx?.sbs_code || '').trim();\n    if (!code) return;\n    const description = String(ctx?.description || ctx?.desc || ctx?.official_description || '').trim();\n    const unitPrice = Number(ctx?.fee || ctx?.unitPrice || 0);\n\n    setCurrentItem((prev) => ({\n      ...prev,\n      sbsCode: code,\n      description: description || prev.description || '',\n      unitPrice: Number.isFinite(unitPrice) ? unitPrice : prev.unitPrice\n    }));\n    setShowSuggestions(false);\n    setSbsSuggestions([]);\n\n    toast.info(`${t.toast.stagedLoaded}: ${code}`);\n  }, [toast, t.toast.stagedLoaded]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const tryRead = (storage) => {\n      try { return storage.getItem('sbs_claim_context_code'); } catch { return null; }\n    };\n    const raw =\n      tryRead(window.sessionStorage) ||\n      tryRead(window.localStorage);\n    if (!raw) return;\n    try {\n      const parsed = JSON.parse(raw);\n      applyClaimContext(parsed);\n    } catch {\n      // ignore\n    } finally {\n      try { window.sessionStorage.removeItem('sbs_claim_context_code'); } catch {}\n      try { window.localStorage.removeItem('sbs_claim_context_code'); } catch {}\n    }\n  }, [applyClaimContext]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const handler = (event) => applyClaimContext(event?.detail);\n    window.addEventListener('sbs:claim-context', handler);\n    return () => window.removeEventListener('sbs:claim-context', handler);\n  }, [applyClaimContext]);\n\n  const getSuggestionConfidence = (item) => {\n    const c = item?.confidence;\n    if (typeof c === 'number' && Number.isFinite(c)) {\n      return Math.max(0, Math.min(1, c));\n    }\n    const score = item?.score;\n    if (typeof score === 'number' && Number.isFinite(score)) {\n      // Map local fuzzy score to a human-friendly \"match\" signal.\n      return Math.max(0.35, Math.min(0.92, score / 100));\n    }\n    return 0.55;\n  };\n\n  // \"Top Pick\" should follow the UI ordering (most relevant first),\n  // not the raw confidence value (AI suggestions may have higher confidence).\n  const topPickCode = sbsSuggestions?.[0]?.code || '';\n\n  const individualTotal = claim.items.reduce((sum, item) => sum + (item.netPrice || 0), 0);\n  const recommendedBundle = bundleInfo?.recommendedBundle || null;\n  const bundleSavings = recommendedBundle ? Math.max(0, individualTotal - recommendedBundle.totalPrice) : 0;\n  const bundleSavingsPct = individualTotal > 0 ? Math.round((bundleSavings / individualTotal) * 100) : 0;\n\n  const applyRecommendedBundle = () => {\n    if (!recommendedBundle) return;\n    setClaim((prev) => ({\n      ...prev,\n      bundleApplied: true,\n      bundleId: recommendedBundle.id\n    }));\n    toast.success(`${t.toast.bundleApplied}: ${recommendedBundle.name}`);\n  };\n\n  const clearBundle = () => {\n    setClaim((prev) => ({ ...prev, bundleApplied: false, bundleId: null }));\n    toast.info(t.toast.bundleCleared);\n  };\n\n  const verifyEligibility = async () => {\n    setFormAttempted((prev) => ({ ...prev, identity: true }));\n    const pidError = validatePatientId(claim.patientId);\n    const emailError = validateEmail(claim.userEmail);\n    if (pidError || emailError) {\n      setTouched((prev) => ({\n        ...prev,\n        patientId: true,\n        userEmail: true\n      }));\n      toast.warning(pidError || emailError || t.toast.fixFields);\n      if (pidError) patientIdRef.current?.focus?.();\n      else if (emailError) userEmailRef.current?.focus?.();\n      return;\n    }\n    \n    setLoading(true);\n    try {\n      const result = await nphiesService.checkEligibility({\n        patientId: claim.patientId,\n        insurerId: 'INS-AUTO',\n        policyNumber: claim.policyNumber || `POL-${claim.patientId}`,\n        serviceDate: claim.serviceDate\n      });\n      \n      setEligibility(result);\n      setClaim(prev => ({ ...prev, policyNumber: result.policyNumber }));\n      \n      if (result.eligible) {\n        toast.success(t.toast.eligible);\n        setStep(2);\n      } else {\n        toast.error(t.toast.ineligible);\n      }\n    } catch (error) {\n      toast.error(t.toast.verifyFail);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSbsSearch = useCallback(async (query) => {\n    setCurrentItem(prev => ({ ...prev, sbsCode: query }));\n    if (query.length >= 2) {\n      setIsSearching(true);\n      try {\n        const results = await aiAssistant.smartSearch(query, { limit: 10, includeAI: true });\n        setSbsSuggestions(results.results);\n        setShowSuggestions(true);\n        if (results.aiInsights) setAiInsights(results.aiInsights);\n      } catch (error) {\n        try {\n          const fallback = await aiAssistant.smartSearch(query, { limit: 10, includeAI: false });\n          setSbsSuggestions(fallback.results);\n          setShowSuggestions(true);\n        } catch {\n          setSbsSuggestions([]);\n          setShowSuggestions(false);\n          toast.warning(t.toast.searchUnavailable);\n        }\n      } finally {\n        setIsSearching(false);\n      }\n    } else {\n      setSbsSuggestions([]);\n      setShowSuggestions(false);\n      setAiInsights(null);\n    }\n  }, []);\n\n  const selectSbsCode = (item) => {\n    setCurrentItem({\n      sbsCode: item.code,\n      description: item.desc,\n      quantity: 1,\n      unitPrice: item.fee || 250\n    });\n    setShowSuggestions(false);\n    setAiInsights(null);\n  };\n\n  const addItem = () => {\n    setFormAttempted((prev) => ({ ...prev, item: true }));\n    const codeError = validateItemSbsCode(currentItem.sbsCode);\n    const qtyError = validateQuantity(currentItem.quantity);\n    const priceError = validateUnitPrice(currentItem.unitPrice);\n    if (codeError || qtyError || priceError) {\n      setTouched((prev) => ({\n        ...prev,\n        itemSbsCode: true,\n        itemQuantity: true,\n        itemUnitPrice: true\n      }));\n      toast.warning(codeError || qtyError || priceError || t.toast.fixFields);\n      if (codeError) itemSbsCodeRef.current?.focus?.();\n      return;\n    }\n    const newItem = {\n      ...currentItem,\n      sequence: claim.items.length + 1,\n      netPrice: currentItem.quantity * currentItem.unitPrice\n    };\n    const newItems = [...claim.items, newItem];\n    setClaim(prev => ({ ...prev, items: newItems }));\n    setCurrentItem({ sbsCode: '', description: '', quantity: 1, unitPrice: 0 });\n    setFormAttempted((prev) => ({ ...prev, item: false }));\n    setTouched((prev) => ({\n      ...prev,\n      itemSbsCode: false,\n      itemQuantity: false,\n      itemUnitPrice: false\n    }));\n    \n    checkBundles(newItems);\n    checkPriorAuth(newItem);\n    validateClaimWithAI(newItems);\n  };\n\n  const removeItem = (index) => {\n    const newItems = claim.items.filter((_, i) => i !== index);\n    setClaim(prev => ({ ...prev, items: newItems }));\n    checkBundles(newItems);\n    if (newItems.length > 0) validateClaimWithAI(newItems);\n    else setValidation(null);\n  };\n\n  const checkBundles = (items) => {\n    const sbsCodes = items.map(item => item.sbsCode);\n    const result = nphiesService.detectBundles(sbsCodes);\n    setBundleInfo(result.hasApplicableBundles ? result : null);\n    // If bundles are no longer applicable, clear any previously applied bundle.\n    if (!result.hasApplicableBundles) {\n      setClaim((prev) => prev.bundleApplied ? { ...prev, bundleApplied: false, bundleId: null } : prev);\n      return;\n    }\n    // If the recommendation changed, avoid silently keeping an outdated applied bundle.\n    const nextId = result.recommendedBundle?.id || null;\n    if (nextId) {\n      setClaim((prev) => (prev.bundleApplied && prev.bundleId && prev.bundleId !== nextId)\n        ? { ...prev, bundleApplied: false, bundleId: null }\n        : prev);\n    }\n  };\n\n  const checkPriorAuth = (item) => {\n    const highValueCodes = ['49518', '38200', '39703', '38218', '30443', '30571'];\n    const codePrefix = item.sbsCode.split('-')[0];\n    if (highValueCodes.includes(codePrefix) || item.unitPrice > 5000) {\n      setPriorAuthRequired(prev => [...prev, item.sbsCode]);\n    }\n  };\n\n  const validateClaimWithAI = async (items) => {\n    setIsValidating(true);\n    try {\n      const result = await aiAssistant.validateClaim({...claim, items});\n      setValidation(result);\n    } finally {\n      setIsValidating(false);\n    }\n  };\n\n  const calculateTotal = () => {\n    if (claim.bundleApplied && recommendedBundle) {\n      return recommendedBundle.totalPrice;\n    }\n    return claim.items.reduce((sum, item) => sum + item.netPrice, 0);\n  };\n\n  const submitClaim = async () => {\n    setSubmitting(true);\n    try {\n      const payload = {\n        patientName: claim.patientName,\n        patientId: claim.patientId,\n        // Optional in backend, but include for consistency across UIs.\n        memberId: claim.patientId,\n        claimType: claim.claimType,\n        userEmail: claim.userEmail,\n        facilityId: claim.facilityId,\n        services: claim.items.map((item) => ({\n          // The enhanced endpoint maps internalCode -> internal_code and sbsCode -> service_code.\n          // In this UI, we only capture SBS codes, so mirror the value for internalCode.\n          internalCode: item.sbsCode,\n          sbsCode: item.sbsCode,\n          description: item.description,\n          quantity: item.quantity,\n          unitPrice: item.unitPrice,\n          serviceDate: item.serviceDate || claim.serviceDate\n        })),\n        servicesTotal: calculateTotal()\n      };\n\n      const res = await fetch('/api/submit-claim-enhanced', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload)\n      });\n      const result = await res.json();\n      if (!res.ok || !result?.success) {\n        throw new Error(result?.error || result?.message || `Submission failed (HTTP ${res.status})`);\n      }\n      setSubmissionResult(result);\n      setStep(4);\n      toast.success(t.toast.submitted);\n    } catch (e) {\n      toast.error(e?.message || t.toast.submissionFailed);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const formatCurrency = (amount) => {\n    return new Intl.NumberFormat(lang === 'ar' ? 'ar-SA' : 'en-SA', { style: 'currency', currency: 'SAR', minimumFractionDigits: 0 }).format(amount);\n  };\n\n  return (\n    <div className=\"flex-1\">\n      <main className=\"max-w-[1400px] mx-auto p-6 sm:p-8 space-y-8 stagger-children\">\n        \n        {/* Header and Progress */}\n        <section className=\"animate-premium-in\">\n          <SectionHeader \n            title={t.header.title} \n            subtitle={t.header.subtitle}\n            badge={t.header.badge}\n          />\n\n          <div className=\"mt-10 mb-2 relative flex items-center justify-between max-w-3xl mx-auto\">\n            <div className=\"absolute top-1/2 left-0 right-0 h-1 bg-slate-200 dark:bg-slate-800 -translate-y-1/2 rounded-full\"></div>\n            <div \n              className=\"absolute top-1/2 left-0 h-1 bg-blue-600 -translate-y-1/2 rounded-full transition-all duration-700\"\n              style={{ width: `${((step - 1) / 3) * 100}%` }}\n            ></div>\n            \n            {[\n              { n: 1, icon: 'person_search', label: t.steps.identity },\n              { n: 2, icon: 'add_task', label: t.steps.services },\n              { n: 3, icon: 'fact_check', label: t.steps.review },\n              { n: 4, icon: 'check_circle', label: t.steps.relayed }\n            ].map(s => (\n              <div key={s.n} className=\"relative z-10 flex flex-col items-center gap-2\">\n                <div className={`size-12 rounded-2xl flex items-center justify-center transition-all duration-500 shadow-xl ${\n                  step >= s.n ? 'bg-blue-600 text-white scale-110 shadow-blue-600/20' : 'bg-white dark:bg-slate-800 text-slate-400'\n                }`}>\n                  <span aria-hidden=\"true\" className=\"material-symbols-outlined text-2xl\">{s.icon}</span>\n                </div>\n                <span className={`text-[10px] font-black uppercase tracking-widest ${step >= s.n ? 'text-blue-600' : 'text-slate-400'}`}>\n                  {s.label}\n                </span>\n              </div>\n            ))}\n          </div>\n        </section>\n\n        <div className=\"min-h-[600px]\">\n          {step === 1 && (\n            <Card className=\"max-w-4xl mx-auto animate-premium-in shadow-2xl\">\n              <CardHeader title={t.identity.title} subtitle={t.identity.subtitle} />\n              <CardBody>\n                <form\n                  className=\"grid md:grid-cols-2 gap-8\"\n                  onSubmit={(e) => {\n                    e.preventDefault();\n                    verifyEligibility();\n                  }}\n                  noValidate\n                >\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"claimbuilder-patient-id\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">\n                        {t.identity.patientId} <span aria-hidden=\"true\" className=\"text-rose-500\">{' '}*</span>\n                      </label>\n                      <div className=\"relative group\">\n                        <span aria-hidden=\"true\" className=\"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600\">fingerprint</span>\n                        <input \n                          ref={patientIdRef}\n                          type=\"text\"\n                          id=\"claimbuilder-patient-id\"\n                          className={`w-full pl-12 pr-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold focus:outline-none focus:ring-2 ${\n                            fieldErrors.patientId\n                              ? 'border-rose-500/60 dark:border-rose-500/50 focus:ring-rose-500/20'\n                              : 'border-slate-200 dark:border-slate-800 focus:ring-blue-600/20'\n                          }`}\n                          placeholder=\"Enter Saudi ID / Iqama\"\n                          value={claim.patientId}\n                          data-testid=\"claimbuilder-patient-id\"\n                          inputMode=\"numeric\"\n                          pattern=\"[0-9]{10}\"\n                          required\n                          aria-invalid={!!fieldErrors.patientId}\n                          aria-describedby={fieldErrors.patientId ? 'claimbuilder-patient-id-error' : undefined}\n                          onBlur={() => setTouched((prev) => ({ ...prev, patientId: true }))}\n                          onChange={(e) => setClaim({...claim, patientId: e.target.value})}\n                        />\n                      </div>\n                      {fieldErrors.patientId && (\n                        <p id=\"claimbuilder-patient-id-error\" role=\"alert\" className=\"text-[11px] font-semibold text-rose-600 ml-1\">\n                          {fieldErrors.patientId}\n                        </p>\n                      )}\n                    </div>\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"claimbuilder-patient-name\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">{t.identity.patientName}</label>\n                      <input \n                        type=\"text\" \n                        id=\"claimbuilder-patient-name\"\n                        className=\"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20\"\n                        placeholder=\"e.g. Fadil Ahmad\"\n                        value={claim.patientName}\n                        onChange={(e) => setClaim({...claim, patientName: e.target.value})}\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"claimbuilder-user-email\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">{t.identity.email}</label>\n                      <input \n                        ref={userEmailRef}\n                        type=\"email\"\n                        id=\"claimbuilder-user-email\"\n                        className={`w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold focus:outline-none focus:ring-2 ${\n                          fieldErrors.userEmail\n                            ? 'border-rose-500/60 dark:border-rose-500/50 focus:ring-rose-500/20'\n                            : 'border-slate-200 dark:border-slate-800 focus:ring-blue-600/20'\n                        }`}\n                        placeholder=\"billing-notifications@provider.com\"\n                        value={claim.userEmail}\n                        aria-invalid={!!fieldErrors.userEmail}\n                        aria-describedby={fieldErrors.userEmail ? 'claimbuilder-user-email-error' : undefined}\n                        onBlur={() => setTouched((prev) => ({ ...prev, userEmail: true }))}\n                        onChange={(e) => setClaim({...claim, userEmail: e.target.value})}\n                      />\n                      {fieldErrors.userEmail && (\n                        <p id=\"claimbuilder-user-email-error\" role=\"alert\" className=\"text-[11px] font-semibold text-rose-600 ml-1\">\n                          {fieldErrors.userEmail}\n                        </p>\n                      )}\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"space-y-1.5\">\n                        <label htmlFor=\"claimbuilder-service-date\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">{t.identity.serviceDate}</label>\n                        <input \n                          type=\"date\"\n                          id=\"claimbuilder-service-date\"\n                          className=\"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20\"\n                          value={claim.serviceDate}\n                          onChange={(e) => setClaim({...claim, serviceDate: e.target.value})}\n                        />\n                      </div>\n                      <div className=\"space-y-1.5\">\n                        <label htmlFor=\"claimbuilder-claim-type\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">{t.identity.claimType}</label>\n                        <select \n                          id=\"claimbuilder-claim-type\"\n                          className=\"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20 appearance-none pointer-events-auto\"\n                          value={claim.claimType}\n                          onChange={(e) => setClaim({...claim, claimType: e.target.value})}\n                        >\n                          <option value=\"institutional\">Institutional</option>\n                          <option value=\"professional\">Professional</option>\n                          <option value=\"pharmacy\">Pharmacy</option>\n                          <option value=\"vision\">Vision</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"md:col-span-2 pt-6 border-t border-slate-100 dark:border-slate-800\">\n                    <Button\n                      type=\"submit\"\n                      loading={loading}\n                      icon=\"verified\"\n                      className=\"w-full py-4 rounded-2xl\"\n                      data-testid=\"claimbuilder-validate-identity\"\n                    >\n                      {t.identity.proceed}\n                    </Button>\n                    <p className=\"mt-4 text-[11px] font-semibold text-slate-500\">\n                      {t.identity.consent}{' '}\n                      <button\n                        type=\"button\"\n                        onClick={() => window.dispatchEvent(new CustomEvent('sbs:navigate', { detail: { view: 'privacy' } }))}\n                        className=\"underline underline-offset-4 hover:text-blue-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white\"\n                      >\n                        {lang === 'ar' ? 'ÿπÿ±ÿ∂ ÿßŸÑÿÆÿµŸàÿµŸäÿ©' : 'View privacy'}\n                      </button>\n                    </p>\n                  </div>\n                </form>\n              </CardBody>\n            </Card>\n          )}\n\n          {step === 2 && (\n            <div className=\"grid lg:grid-cols-3 gap-8 animate-premium-in\">\n               <div className=\"lg:col-span-2 space-y-6\">\n                  {/* Service Entry */}\n                  <Card>\n                     <CardHeader title={t.services.title} subtitle={t.services.subtitle} />\n                     <CardBody className=\"space-y-6\">\n                        <div className=\"relative space-y-2\">\n                          <label htmlFor=\"claimbuilder-item-sbs\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">\n                             {t.services.code} <span aria-hidden=\"true\" className=\"text-rose-500\">{' '}*</span>\n                           </label>\n                           <div className=\"relative\">\n                              <span aria-hidden=\"true\" className=\"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\">search</span>\n                              <input \n                                ref={itemSbsCodeRef}\n                                type=\"text\"\n                                id=\"claimbuilder-item-sbs\"\n                                role=\"combobox\"\n                                aria-autocomplete=\"list\"\n                                aria-expanded={showSuggestions && sbsSuggestions.length > 0}\n                                aria-controls=\"claimbuilder-sbs-suggestions\"\n                                aria-invalid={!!fieldErrors.itemSbsCode}\n                                aria-describedby={fieldErrors.itemSbsCode ? 'claimbuilder-item-sbs-error' : undefined}\n                                className={`w-full pl-12 pr-12 py-4 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold focus:outline-none focus:ring-2 ${\n                                  fieldErrors.itemSbsCode\n                                    ? 'border-rose-500/60 dark:border-rose-500/50 focus:ring-rose-500/20'\n                                    : 'border-slate-200 dark:border-slate-800 focus:ring-blue-600/20'\n                                }`}\n                                placeholder=\"Search by code or describe in natural language...\"\n                                value={currentItem.sbsCode}\n                                data-testid=\"claimbuilder-item-sbs\"\n                                required\n                                onBlur={() => setTouched((prev) => ({ ...prev, itemSbsCode: true }))}\n                                onChange={(e) => handleSbsSearch(e.target.value)}\n                              />\n                              {isSearching && <span aria-hidden=\"true\" className=\"material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 animate-spin text-blue-600\">progress_activity</span>}\n                           </div>\n                           \n                           {showSuggestions && sbsSuggestions.length > 0 && (\n                             <div\n                               id=\"claimbuilder-sbs-suggestions\"\n                               role=\"listbox\"\n                               className=\"absolute z-50 w-full mt-2 glass-panel border border-slate-200/50 dark:border-slate-700/50 rounded-2xl shadow-2xl max-h-72 overflow-y-auto overflow-x-hidden\"\n                             >\n                                {aiInsights && <div className=\"px-5 py-2.5 bg-blue-600 font-bold text-white text-[11px] flex items-center gap-2\">\n                                   <span aria-hidden=\"true\" className=\"material-symbols-outlined text-sm\">auto_awesome</span> {aiInsights}\n                                </div>}\n                                {sbsSuggestions.map((item, idx) => (\n                                  (() => {\n                                    const conf = getSuggestionConfidence(item);\n                                    const confPct = Math.round(conf * 100);\n                                    const isTopPick = topPickCode && item.code === topPickCode;\n                                    const reasoning = item.aiReason || item.aiReasoning || item.reason || '';\n                                    const isAi = item.source === 'ai' || typeof item.confidence === 'number';\n                                    return (\n                                      <button\n                                        type=\"button\"\n                                        role=\"option\"\n                                        key={idx}\n                                        onMouseDown={(e) => {\n                                          e.preventDefault();\n                                          selectSbsCode(item);\n                                        }}\n                                        data-testid={isTopPick ? 'sbs-suggestion-top-pick' : `sbs-suggestion-${idx}`}\n                                        className={`px-5 py-4 cursor-pointer border-b border-slate-100 dark:border-slate-800 last:border-0 group/item transition-colors ${\n                                          isTopPick\n                                            ? 'bg-gradient-to-r from-blue-600/10 to-emerald-500/10 hover:from-blue-600/15 hover:to-emerald-500/15 border-l-4 border-l-blue-600'\n                                            : 'hover:bg-slate-100 dark:hover:bg-slate-800'\n                                        } focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900`}\n                                      >\n                                        <div className=\"flex items-start justify-between gap-3\">\n                                          <div className=\"flex flex-wrap items-center gap-2\">\n                                            <span className=\"font-mono text-sm font-black text-blue-600 bg-blue-600/10 px-2.5 py-1 rounded-lg border border-blue-600/20\">{item.code}</span>\n                                            {isTopPick && (\n                                              <span className=\"inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-gradient-to-r from-blue-600 to-emerald-500 text-white text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-600/30 animate-pulse\">\n                                                <span aria-hidden=\"true\" className=\"material-symbols-outlined text-[14px]\">auto_awesome</span>\n                                                üåü AI Top Pick\n                                              </span>\n                                            )}\n                                            {isAi && !isTopPick && (\n                                              <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border border-emerald-500/30 text-[10px] font-black uppercase tracking-widest shadow-sm\" title=\"AI-enhanced suggestion\">\n                                                <span aria-hidden=\"true\" className=\"material-symbols-outlined text-[12px]\">smart_toy</span>\n                                                AI\n                                              </span>\n                                            )}\n                                          </div>\n\n                                          <div className=\"flex items-center gap-3\">\n                                            <div className=\"flex flex-col items-end gap-0.5\">\n                                              <div\n                                                className=\"relative h-6 w-28 rounded-full bg-slate-200/80 dark:bg-slate-800/80 overflow-hidden border-2 border-slate-300/70 dark:border-slate-700/60 shadow-inner\"\n                                                title={`${isAi ? 'AI confidence' : 'Match score'}: ${confPct}%`}\n                                              >\n                                                <div\n                                                  className={`h-full transition-all duration-500 ${\n                                                    confPct >= 80 \n                                                      ? 'bg-gradient-to-r from-emerald-500 to-green-600' \n                                                      : confPct >= 60 \n                                                      ? 'bg-gradient-to-r from-blue-500 to-blue-600' \n                                                      : 'bg-gradient-to-r from-amber-500 to-orange-500'\n                                                  }`}\n                                                  style={{ width: `${confPct}%` }}\n                                                ></div>\n                                                <span className=\"absolute right-2 top-1/2 -translate-y-1/2 text-[11px] font-black text-slate-900/90 dark:text-white/90 drop-shadow\">\n                                                  {confPct}%\n                                                </span>\n                                              </div>\n                                              <span className=\"text-[9px] font-bold uppercase text-slate-400\">\n                                                {confPct >= 80 ? 'üéØ Excellent' : confPct >= 60 ? 'üëç Good' : '‚ö†Ô∏è Fair'} Match\n                                              </span>\n                                            </div>\n                                            <span className=\"text-[10px] font-black uppercase text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded\">{item.category || '‚Äî'}</span>\n                                          </div>\n                                        </div>\n\n                                        <p className=\"mt-2 text-sm font-extrabold text-slate-700 dark:text-slate-200\">{item.desc}</p>\n                                        {reasoning && (\n                                          <div\n                                            className=\"mt-3 flex items-start gap-3 p-3.5 rounded-xl bg-gradient-to-r from-blue-600/8 to-purple-600/8 dark:from-blue-600/12 dark:to-purple-600/12 border-2 border-blue-600/20 shadow-sm\"\n                                            title={reasoning}\n                                          >\n                                            <div className=\"flex items-center justify-center w-8 h-8 rounded-full bg-blue-600 text-white shadow-lg flex-shrink-0\">\n                                              <span aria-hidden=\"true\" className=\"material-symbols-outlined text-base\">psychology</span>\n                                            </div>\n                                            <div className=\"flex-1\">\n                                              <div className=\"text-[9px] font-black uppercase tracking-widest text-blue-700 dark:text-blue-400 mb-1\">üí° AI Reasoning</div>\n                                              <p className=\"text-xs font-semibold text-slate-700 dark:text-slate-300 leading-relaxed\">{reasoning}</p>\n                                            </div>\n                                          </div>\n                                        )}\n                                      </button>\n                                    );\n                                  })()\n                                ))}\n                             </div>\n                           )}\n                           {fieldErrors.itemSbsCode && (\n                             <p id=\"claimbuilder-item-sbs-error\" role=\"alert\" className=\"text-[11px] font-semibold text-rose-600 ml-1\">\n                               {fieldErrors.itemSbsCode}\n                             </p>\n                           )}\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                           <div className=\"space-y-2\">\n                              <label className=\"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1\">{t.services.qty}</label>\n                              <input \n                                type=\"number\" \n                                className={`w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold ${\n                                  fieldErrors.itemQuantity ? 'border-rose-500/60 dark:border-rose-500/50' : 'border-slate-200 dark:border-slate-800'\n                                }`}\n                                value={currentItem.quantity}\n                                data-testid=\"claimbuilder-item-qty\"\n                                min=\"1\"\n                                required\n                                aria-invalid={!!fieldErrors.itemQuantity}\n                                aria-describedby={fieldErrors.itemQuantity ? 'claimbuilder-item-qty-error' : undefined}\n                                onBlur={() => setTouched((prev) => ({ ...prev, itemQuantity: true }))}\n                                onChange={(e) => setCurrentItem({...currentItem, quantity: Number(e.target.value)})}\n                              />\n                              {fieldErrors.itemQuantity && (\n                                <p id=\"claimbuilder-item-qty-error\" role=\"alert\" className=\"text-[11px] font-semibold text-rose-600 ml-1 mt-1\">\n                                  {fieldErrors.itemQuantity}\n                                </p>\n                              )}\n                           </div>\n                           <div className=\"space-y-2\">\n                              <label className=\"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1\">{t.services.unitPrice}</label>\n                              <div className=\"relative\">\n                                 <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold\">SAR</span>\n                                 <input \n                                   type=\"number\" \n                                   className={`w-full pl-14 pr-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold ${\n                                     fieldErrors.itemUnitPrice ? 'border-rose-500/60 dark:border-rose-500/50' : 'border-slate-200 dark:border-slate-800'\n                                   }`}\n                                   value={currentItem.unitPrice}\n                                   data-testid=\"claimbuilder-item-unitprice\"\n                                   min=\"1\"\n                                   required\n                                   aria-invalid={!!fieldErrors.itemUnitPrice}\n                                   aria-describedby={fieldErrors.itemUnitPrice ? 'claimbuilder-item-unitprice-error' : undefined}\n                                   onBlur={() => setTouched((prev) => ({ ...prev, itemUnitPrice: true }))}\n                                   onChange={(e) => setCurrentItem({...currentItem, unitPrice: Number(e.target.value)})}\n                                 />\n                              </div>\n                              {fieldErrors.itemUnitPrice && (\n                                <p id=\"claimbuilder-item-unitprice-error\" role=\"alert\" className=\"text-[11px] font-semibold text-rose-600 ml-1 mt-1\">\n                                  {fieldErrors.itemUnitPrice}\n                                </p>\n                              )}\n                           </div>\n                        </div>\n                        <Button\n                          variant=\"secondary\"\n                          className=\"w-full py-4 rounded-2xl border-dashed\"\n                          onClick={addItem}\n                          icon=\"add_box\"\n                          data-testid=\"claimbuilder-add-item\"\n                        >\n                          {t.services.add}\n                        </Button>\n                     </CardBody>\n                  </Card>\n\n                  {/* List of items */}\n                  {claim.items.length > 0 && (\n                    <Card>\n                       <CardHeader title={t.services.payloadTitle} action={<span className=\"text-xl font-black text-blue-600\">{formatCurrency(calculateTotal())}</span>} />\n                       <div className=\"overflow-x-auto\">\n                          <table className=\"w-full text-left\">\n                             <thead className=\"bg-slate-50 dark:bg-slate-900/40\">\n                                <tr>\n                                   <th className=\"px-6 py-4 text-[10px] font-black uppercase text-slate-500\">{t.services.serviceInfo}</th>\n                                   <th className=\"px-6 py-4 text-[10px] font-black uppercase text-slate-500 text-right\">{t.services.netPrice}</th>\n                                   <th className=\"px-6 py-4 text-[10px] font-black uppercase text-slate-500\"></th>\n                                </tr>\n                             </thead>\n                             <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800\">\n                                {claim.items.map((item, idx) => (\n                                  <tr key={idx} className=\"group hover:bg-slate-50/50 dark:hover:bg-slate-800/20 transition-colors\">\n                                     <td className=\"px-6 py-4\">\n                                        <div className=\"flex items-center gap-3\">\n                                           <span className=\"font-mono text-xs font-black bg-blue-600/10 text-blue-600 px-2 py-0.5 rounded\">{item.sbsCode}</span>\n                                           <p className=\"text-sm font-bold text-slate-700 dark:text-slate-200\">{item.description}</p>\n                                        </div>\n                                        <p className=\"text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest\">{item.quantity} Unit √ó {formatCurrency(item.unitPrice)}</p>\n                                     </td>\n                                     <td className=\"px-6 py-4 text-right font-black text-slate-900 dark:text-white\">\n                                        {formatCurrency(item.netPrice)}\n                                     </td>\n                                     <td className=\"px-6 py-4 text-right\">\n                                        <button\n                                          type=\"button\"\n                                          onClick={() => removeItem(idx)}\n                                          className=\"p-2 text-slate-300 hover:text-rose-500 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900\"\n                                          aria-label={`Remove service ${item.sbsCode}`}\n                                        >\n                                          <span aria-hidden=\"true\" className=\"material-symbols-outlined text-lg\">delete</span>\n                                        </button>\n                                     </td>\n                                  </tr>\n                                ))}\n                             </tbody>\n                          </table>\n                       </div>\n                    </Card>\n                  )}\n               </div>\n\n               <div className=\"space-y-6\">\n                  {/* AI Validation */}\n                  {(validation || isValidating) && (\n                    <Card className={`border-l-4 transition-colors ${isValidating ? 'border-l-blue-600 animate-pulse' : validation?.errors?.length > 0 ? 'border-l-rose-500' : 'border-l-emerald-500 shadow-emerald-500/10'}`}>\n                       <CardBody className=\"space-y-4\">\n                          <div className=\"flex items-center gap-2\">\n                             <span aria-hidden=\"true\" className={`material-symbols-outlined font-black ${isValidating ? 'text-blue-600' : validation?.errors?.length > 0 ? 'text-rose-500' : 'text-emerald-500'}`}>\n                                {isValidating ? 'sync' : validation?.errors?.length > 0 ? 'report' : 'verified'}\n                             </span>\n                             <h4 className=\"text-sm font-black uppercase tracking-widest text-slate-900 dark:text-white\">AI Compliance Agent</h4>\n                          </div>\n                          \n                          {validation?.errors?.map((err, i) => (\n                            <div key={i} className=\"p-3 bg-rose-500/10 border border-rose-500/20 rounded-xl text-xs font-bold text-rose-600 flex gap-2\">\n                               <span aria-hidden=\"true\" className=\"material-symbols-outlined text-xs\">close</span> {err}\n                            </div>\n                          ))}\n                          {validation?.warnings?.map((err, i) => (\n                            <div key={i} className=\"p-3 bg-amber-500/10 border border-amber-500/20 rounded-xl text-xs font-bold text-amber-600 flex gap-2\">\n                               <span aria-hidden=\"true\" className=\"material-symbols-outlined text-xs\">warning</span> {err}\n                            </div>\n                          ))}\n                          \n                          {validation?.suggestions?.map((sug, i) => (\n                            <div key={i} className=\"p-4 glass-panel border border-blue-600/20 rounded-2xl space-y-3\">\n                               <div className=\"flex items-start gap-2\">\n                                  <span aria-hidden=\"true\" className=\"material-symbols-outlined text-blue-600 text-sm\">auto_awesome</span>\n                                  <p className=\"text-xs font-bold text-slate-700 dark:text-slate-300 leading-relaxed\">{sug.reason || sug.name}</p>\n                               </div>\n                               <button onClick={() => toast.info('Optimizing...')} className=\"w-full py-2 bg-blue-600 text-white text-[10px] font-black uppercase tracking-widest rounded-lg shadow-lg shadow-blue-600/20 transition-transform active:scale-95\">Optimize with Agent</button>\n                            </div>\n                          ))}\n\n                          {!isValidating && !validation?.errors?.length && claim.items.length > 0 && (\n                            <div className=\"text-center py-4 bg-emerald-500/5 rounded-2xl border border-emerald-500/10\">\n                               <p className=\"text-xs font-black text-emerald-600 uppercase tracking-widest\">Compliance Guaranteed</p>\n                            </div>\n                          )}\n                       </CardBody>\n                    </Card>\n                  )}\n\n                  {/* Bundle Opportunity - Enhanced with Visual Savings Calculator */}\n                  {recommendedBundle && claim.items.length > 0 && (\n                    <Card className=\"border-2 border-amber-500/40 bg-gradient-to-br from-amber-50 via-orange-50/50 to-amber-100/80 dark:from-amber-500/10 dark:to-orange-500/5 shadow-2xl shadow-amber-500/20 relative overflow-hidden\">\n                      {/* Animated background sparkle effect */}\n                      <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_120%,rgba(251,191,36,0.1),transparent_50%)] pointer-events-none\"></div>\n                      \n                      <CardBody className=\"space-y-5 relative z-10\">\n                        <div className=\"flex items-start justify-between gap-4\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"relative\">\n                              <span aria-hidden=\"true\" className=\"material-symbols-outlined text-amber-500 text-4xl animate-pulse\">redeem</span>\n                              <div className=\"absolute -top-1 -right-1 w-3 h-3 bg-emerald-500 rounded-full animate-ping\"></div>\n                            </div>\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center gap-2\">\n                                <div className=\"text-[11px] font-black uppercase tracking-widest text-amber-600\">üéÅ Bundle Opportunity</div>\n                                <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500 text-white text-[9px] font-black uppercase tracking-widest\">\n                                  <span aria-hidden=\"true\" className=\"material-symbols-outlined text-[12px]\">auto_awesome</span>\n                                  AI Detected\n                                </span>\n                              </div>\n                              <div className=\"text-base font-black text-slate-900 dark:text-white\">{recommendedBundle.name}</div>\n                            </div>\n                          </div>\n                          <span className=\"text-[10px] font-black uppercase tracking-widest px-3 py-1.5 rounded-full border-2 border-amber-500/40 bg-white/90 dark:bg-slate-900/60 text-amber-700 dark:text-amber-400 shadow-lg\" title=\"Match percentage based on required codes detected in your session\">\n                            {Math.round(recommendedBundle.matchPercentage || 0)}% match\n                          </span>\n                        </div>\n\n                        <p className=\"text-xs font-semibold text-slate-700 dark:text-slate-300 leading-relaxed\">\n                          {recommendedBundle.description}\n                        </p>\n\n                        {/* Visual Comparison - Enhanced */}\n                        <div className=\"relative\">\n                          <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20\">\n                            <div className=\"flex flex-col items-center gap-1\">\n                              <span aria-hidden=\"true\" className=\"material-symbols-outlined text-3xl text-emerald-600 drop-shadow-lg animate-bounce\">trending_flat</span>\n                              <span className=\"text-[9px] font-black uppercase tracking-widest text-emerald-700 bg-white/90 dark:bg-slate-900/80 px-2 py-0.5 rounded-full border border-emerald-500/30\">\n                                Save\n                              </span>\n                            </div>\n                          </div>\n                          \n                          <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"p-5 bg-white/90 dark:bg-slate-900/50 border-2 border-slate-300/80 dark:border-slate-700/60 rounded-2xl shadow-lg relative\">\n                              <div className=\"text-[10px] font-black uppercase tracking-widest text-slate-400 mb-1\">Individual Codes</div>\n                              <div className=\"text-2xl font-black text-slate-900 dark:text-white\">{formatCurrency(individualTotal)}</div>\n                              <div className=\"text-[9px] font-bold text-slate-400 uppercase tracking-wider mt-1\">Standard Pricing</div>\n                            </div>\n                            <div className=\"p-5 bg-gradient-to-br from-emerald-500/20 to-blue-600/20 border-2 border-emerald-500/40 rounded-2xl shadow-xl relative\">\n                              <div className=\"absolute -top-2 -right-2 bg-emerald-600 text-white text-[8px] font-black uppercase px-2 py-1 rounded-full shadow-lg\">\n                                Best Value\n                              </div>\n                              <div className=\"text-[10px] font-black uppercase tracking-widest text-emerald-700 dark:text-emerald-400 mb-1\">Bundle Price</div>\n                              <div className=\"text-2xl font-black text-emerald-700 dark:text-emerald-400\">{formatCurrency(recommendedBundle.totalPrice)}</div>\n                              <div className=\"text-[9px] font-bold text-emerald-600 dark:text-emerald-500 uppercase tracking-wider mt-1\">Optimized Rate</div>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Savings Highlight - Enhanced */}\n                        <div className=\"p-4 rounded-2xl bg-gradient-to-r from-emerald-500/20 to-green-500/20 border-2 border-emerald-500/40 flex items-center justify-between gap-3 shadow-lg\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"flex items-center justify-center w-10 h-10 rounded-full bg-emerald-600 text-white shadow-lg\">\n                              <span aria-hidden=\"true\" className=\"material-symbols-outlined text-xl\">savings</span>\n                            </div>\n                            <div>\n                              <div className=\"text-[10px] font-black uppercase tracking-widest text-emerald-800 dark:text-emerald-300\">You Save</div>\n                              <div className=\"text-lg font-black text-emerald-700 dark:text-emerald-400\">\n                                {formatCurrency(bundleSavings)} <span className=\"text-sm\">({bundleSavingsPct}%)</span>\n                              </div>\n                            </div>\n                          </div>\n                          {claim.bundleApplied ? (\n                            <span className=\"flex items-center gap-1.5 text-[10px] font-black uppercase tracking-widest px-3 py-1.5 rounded-full bg-emerald-600 text-white shadow-lg\">\n                              <span aria-hidden=\"true\" className=\"material-symbols-outlined text-sm\">check_circle</span>\n                              Applied\n                            </span>\n                          ) : (\n                            <span className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 px-3 py-1.5 bg-white/50 dark:bg-slate-800/50 rounded-full\">Optional</span>\n                          )}\n                        </div>\n\n                        <div className=\"flex gap-3\">\n                          <Button\n                            variant={claim.bundleApplied ? 'secondary' : 'success'}\n                            className=\"flex-1 py-4 rounded-2xl text-base font-black shadow-xl hover:shadow-2xl transition-all duration-200 hover:scale-[1.02]\"\n                            onClick={claim.bundleApplied ? clearBundle : applyRecommendedBundle}\n                            icon={claim.bundleApplied ? 'undo' : 'auto_fix_high'}\n                            data-testid=\"claimbuilder-apply-bundle\"\n                          >\n                            {claim.bundleApplied ? '‚Ü©Ô∏è Clear Bundle' : `‚ú® Apply ${recommendedBundle.name} Bundle`}\n                          </Button>\n                        </div>\n\n                        {/* AI Confidence Note */}\n                        <div className=\"flex items-start gap-2 p-3 rounded-xl bg-blue-600/5 dark:bg-blue-600/10 border border-blue-600/10\">\n                          <span aria-hidden=\"true\" className=\"material-symbols-outlined text-blue-600 text-sm\">psychology</span>\n                          <p className=\"text-[10px] font-semibold text-slate-600 dark:text-slate-300 leading-relaxed\">\n                            <strong>AI Recommendation:</strong> This bundle was automatically detected based on your selected services. Applying it will optimize your claim for faster approval and maximum reimbursement.\n                          </p>\n                        </div>\n                      </CardBody>\n                    </Card>\n                  )}\n\n                  {/* Summary Card */}\n                  <Card className=\"bg-slate-900 text-white shadow-2xl\">\n                     <CardBody className=\"space-y-6\">\n                        <div className=\"space-y-1\">\n                           <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Total Adjudicated Amount</p>\n                           <h3 className=\"text-4xl font-black tracking-tighter text-blue-500\">{formatCurrency(calculateTotal())}</h3>\n                        </div>\n                        <div className=\"space-y-3 pt-6 border-t border-white/10\">\n                           <div className=\"flex justify-between text-xs font-bold text-slate-400\">\n                              <span>Patient Coverage</span>\n                              <span className=\"text-emerald-500\">92% Cover</span>\n                           </div>\n                           <div className=\"flex justify-between text-xs font-bold text-slate-400\">\n                              <span>Taxes / VAT</span>\n                              <span>SAR 0.00</span>\n                           </div>\n                        </div>\n                        <Button className=\"w-full py-4 rounded-2xl\" onClick={() => setStep(3)} data-testid=\"claimbuilder-proceed-review\">\n                          Proceed to Review\n                        </Button>\n                     </CardBody>\n                  </Card>\n               </div>\n            </div>\n          )}\n\n          {step === 3 && (\n            <Card className=\"max-w-3xl mx-auto animate-premium-in shadow-2xl overflow-hidden\">\n               <div className=\"p-12 text-center space-y-6 bg-slate-900 text-white\">\n                  <div className=\"size-20 bg-blue-600 rounded-[28px] flex items-center justify-center mx-auto shadow-2xl shadow-blue-600/40\">\n                     <span aria-hidden=\"true\" className=\"material-symbols-outlined text-4xl\">fact_check</span>\n                  </div>\n                  <div className=\"space-y-2\">\n                     <h2 className=\"text-4xl font-black tracking-tighter\">Final Verification</h2>\n                     <p className=\"text-slate-400 font-bold uppercase tracking-widest text-xs\">Review the operational payload before national relay</p>\n                  </div>\n               </div>\n               <CardBody className=\"p-8 space-y-8\">\n                  <div className=\"grid grid-cols-2 gap-6 pb-8 border-b border-slate-100 dark:border-slate-800\">\n                     <div>\n                        <p className=\"text-[10px] font-black uppercase text-slate-400\">Relaying to</p>\n                        <p className=\"text-lg font-black text-slate-800 dark:text-white\">NPHIES Production</p>\n                     </div>\n                     <div className=\"text-right\">\n                        <p className=\"text-[10px] font-black uppercase text-slate-400\">Claim Value</p>\n                        <p className=\"text-lg font-black text-blue-600\">{formatCurrency(calculateTotal())}</p>\n                     </div>\n                  </div>\n                  <div className=\"space-y-4\">\n                     <p className=\"text-[10px] font-black uppercase text-slate-400 text-center\">Security Check</p>\n                     <div className=\"flex justify-center gap-4\">\n                        <div className=\"flex items-center gap-2 text-xs font-bold text-emerald-500\"><span aria-hidden=\"true\" className=\"material-symbols-outlined text-sm\">shield</span> Digital Signature Ready</div>\n                        <div className=\"flex items-center gap-2 text-xs font-bold text-emerald-500\"><span aria-hidden=\"true\" className=\"material-symbols-outlined text-sm\">lock</span> RSA-2048 Active</div>\n                     </div>\n                  </div>\n                  <div className=\"flex gap-4 pt-4\">\n                     <Button variant=\"secondary\" className=\"flex-1 py-4\" onClick={() => setStep(2)}>Modify Session</Button>\n                     <Button\n                       loading={submitting}\n                       icon=\"bolt\"\n                       className=\"flex-[2] py-4\"\n                       onClick={submitClaim}\n                       data-testid=\"claimbuilder-submit\"\n                     >\n                       Sign & Submit to NPHIES\n                     </Button>\n                  </div>\n               </CardBody>\n            </Card>\n          )}\n\n          {step === 4 && (\n            <div className=\"max-w-2xl mx-auto text-center space-y-8 animate-premium-in py-12\">\n               <div className=\"relative\">\n                  <div className=\"size-32 bg-emerald-500 rounded-[40px] flex items-center justify-center mx-auto shadow-2xl shadow-emerald-500/20 scale-110\">\n                     <span aria-hidden=\"true\" className=\"material-symbols-outlined text-6xl text-white\">verified</span>\n                  </div>\n                  <div className=\"absolute inset-x-0 bottom-[-10px] flex justify-center\">\n                     <span className=\"px-4 py-1.5 bg-slate-900 border border-slate-800 text-white rounded-full text-[10px] font-black uppercase tracking-widest shadow-xl\">Transmission Success</span>\n                  </div>\n               </div>\n               <div className=\"space-y-3\">\n                  <h2 className=\"text-4xl font-black tracking-tighter text-slate-900 dark:text-white\">Claim Successfully Relayed</h2>\n                  <p className=\"text-slate-500 font-bold max-w-sm mx-auto leading-relaxed\">Your claim has been normalized, signed and accepted by the national integration gateway.</p>\n               </div>\n               \n               <Card className=\"bg-slate-50 dark:bg-slate-900/40 border-slate-200/50 dark:border-slate-800/50\">\n                  <CardBody className=\"space-y-4 text-left\">\n                     <div className=\"flex justify-between items-center text-sm font-bold\">\n                        <span className=\"text-slate-400 uppercase tracking-widest text-[10px]\">Reference ID</span>\n                        <code className=\"text-blue-600 font-mono\" data-testid=\"claimbuilder-reference\">\n                          {submissionResult?.claimId || 'CLM-88234-X'}\n                        </code>\n                     </div>\n                     <div className=\"flex justify-between items-center text-sm font-bold\">\n                        <span className=\"text-slate-400 uppercase tracking-widest text-[10px]\">Relay Status</span>\n                        <span className=\"text-emerald-500 uppercase\">Accepted</span>\n                     </div>\n                  </CardBody>\n               </Card>\n\n               <div className=\"flex flex-wrap justify-center gap-4\">\n                  <Button icon=\"receipt\" onClick={() => window.open(submissionResult?.trackingUrl, '_blank')}>Download NPHIES Receipt</Button>\n                  <Button variant=\"secondary\" icon=\"refresh\" onClick={() => window.location.reload()}>Build Another Claim</Button>\n               </div>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  );\n}\n"],"names":["ClaimBuilderPage","lang","t","i18n","step","setStep","useState","claim","setClaim","currentItem","setCurrentItem","sbsSuggestions","setSbsSuggestions","showSuggestions","setShowSuggestions","isSearching","setIsSearching","aiInsights","setAiInsights","eligibility","setEligibility","bundleInfo","setBundleInfo","priorAuthRequired","setPriorAuthRequired","validation","setValidation","isValidating","setIsValidating","loading","setLoading","submitting","setSubmitting","submissionResult","setSubmissionResult","claimStatus","setClaimStatus","toast","useToast","formAttempted","setFormAttempted","touched","setTouched","patientIdRef","useRef","userEmailRef","itemSbsCodeRef","validatePatientId","value","v","validateEmail","validateItemSbsCode","validateQuantity","n","validateUnitPrice","fieldErrors","useMemo","applyClaimContext","useCallback","ctx","code","description","unitPrice","prev","useEffect","tryRead","storage","raw","parsed","handler","event","getSuggestionConfidence","item","c","score","topPickCode","individualTotal","sum","recommendedBundle","bundleSavings","bundleSavingsPct","applyRecommendedBundle","clearBundle","verifyEligibility","pidError","emailError","result","nphiesService","handleSbsSearch","query","results","aiAssistant","fallback","selectSbsCode","addItem","codeError","qtyError","priceError","newItem","newItems","checkBundles","checkPriorAuth","validateClaimWithAI","removeItem","index","_","i","items","sbsCodes","nextId","highValueCodes","codePrefix","calculateTotal","submitClaim","payload","res","e","formatCurrency","amount","jsxs","jsx","SectionHeader","s","Card","CardHeader","CardBody","Button","idx","conf","confPct","isTopPick","reasoning","isAi","err","sug"],"mappings":"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"}