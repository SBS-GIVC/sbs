{"version":3,"file":"nphiesService-CN9naE0r.js","sources":["../../src/services/nphiesService.js"],"sourcesContent":["/**\n * NPHIES Integration Service\n * Real-time claims submission, eligibility verification, and prior authorization\n * Based on Saudi NPHIES Platform specifications\n */\n\nimport axios from 'axios';\n\n// NPHIES API Configuration\nconst NPHIES_CONFIG = {\n  baseUrl: import.meta.env.VITE_NPHIES_URL || 'https://sandbox.nphies.sa/api/v1',\n  timeout: 30000,\n  retryAttempts: 3,\n  retryDelay: 1000\n};\n\n// FHIR Resource Types\nconst FHIR_RESOURCES = {\n  CLAIM: 'Claim',\n  CLAIM_RESPONSE: 'ClaimResponse',\n  COVERAGE_ELIGIBILITY_REQUEST: 'CoverageEligibilityRequest',\n  COVERAGE_ELIGIBILITY_RESPONSE: 'CoverageEligibilityResponse',\n  PRIOR_AUTH_REQUEST: 'Claim', // Prior auth uses Claim resource with use: preauthorization\n  PRIOR_AUTH_RESPONSE: 'ClaimResponse'\n};\n\n/**\n * NPHIES API Client\n */\nclass NPHIESService {\n  constructor() {\n    this.client = axios.create({\n      baseURL: NPHIES_CONFIG.baseUrl,\n      timeout: NPHIES_CONFIG.timeout,\n      headers: {\n        'Content-Type': 'application/fhir+json',\n        'Accept': 'application/fhir+json'\n      }\n    });\n    \n    this.accessToken = null;\n    this.tokenExpiry = null;\n  }\n\n  /**\n   * Get authentication token (implement based on NPHIES OAuth flow)\n   */\n  async authenticate() {\n    // In production, implement OAuth2 flow with NPHIES\n    // For now, return mock token for development\n    if (this.accessToken && this.tokenExpiry > Date.now()) {\n      return this.accessToken;\n    }\n    \n    try {\n      // Mock authentication for sandbox\n      this.accessToken = 'sandbox-demo-token';\n      this.tokenExpiry = Date.now() + 3600000; // 1 hour\n      return this.accessToken;\n    } catch (error) {\n      console.error('NPHIES authentication failed:', error);\n      throw new Error('Authentication failed');\n    }\n  }\n\n  /**\n   * Set authorization header\n   */\n  async setAuthHeader() {\n    const token = await this.authenticate();\n    this.client.defaults.headers['Authorization'] = `Bearer ${token}`;\n  }\n\n  // ============================================\n  // ELIGIBILITY VERIFICATION\n  // ============================================\n\n  /**\n   * Check patient eligibility with insurance\n   * @param {Object} params - Patient and insurance details\n   * @returns {Object} Eligibility response\n   */\n  async checkEligibility({ patientId, insurerId, policyNumber, serviceDate }) {\n    await this.setAuthHeader();\n    \n    const eligibilityRequest = this.buildEligibilityRequest({\n      patientId,\n      insurerId,\n      policyNumber,\n      serviceDate: serviceDate || new Date().toISOString().split('T')[0]\n    });\n\n    try {\n      const response = await this.client.post('/CoverageEligibilityRequest', eligibilityRequest);\n      return this.parseEligibilityResponse(response.data);\n    } catch (error) {\n      console.error('Eligibility check failed:', error);\n      // Return mock data for development\n      return this.getMockEligibility(patientId);\n    }\n  }\n\n  /**\n   * Build FHIR CoverageEligibilityRequest\n   */\n  buildEligibilityRequest({ patientId, insurerId, policyNumber, serviceDate }) {\n    return {\n      resourceType: 'CoverageEligibilityRequest',\n      id: `eligibility-${Date.now()}`,\n      status: 'active',\n      purpose: ['validation', 'benefits'],\n      patient: {\n        reference: `Patient/${patientId}`\n      },\n      servicedDate: serviceDate,\n      created: new Date().toISOString(),\n      insurer: {\n        reference: `Organization/${insurerId}`\n      },\n      insurance: [{\n        focal: true,\n        coverage: {\n          reference: `Coverage/${policyNumber}`\n        }\n      }]\n    };\n  }\n\n  /**\n   * Parse eligibility response\n   */\n  parseEligibilityResponse(fhirResponse) {\n    return {\n      eligible: fhirResponse.outcome === 'complete',\n      status: fhirResponse.outcome,\n      policyNumber: fhirResponse.insurance?.[0]?.coverage?.reference?.split('/')[1],\n      coverageStart: fhirResponse.insurance?.[0]?.benefitPeriod?.start,\n      coverageEnd: fhirResponse.insurance?.[0]?.benefitPeriod?.end,\n      benefits: this.extractBenefits(fhirResponse.insurance?.[0]?.item || []),\n      errors: fhirResponse.error?.map(e => e.code?.text) || []\n    };\n  }\n\n  /**\n   * Extract benefit details from FHIR response\n   */\n  extractBenefits(items) {\n    const benefits = {};\n    \n    items.forEach(item => {\n      const category = item.category?.coding?.[0]?.code || 'general';\n      benefits[category] = {\n        category,\n        name: item.category?.coding?.[0]?.display,\n        allowed: item.benefit?.find(b => b.type?.coding?.[0]?.code === 'benefit')?.allowedMoney?.value,\n        used: item.benefit?.find(b => b.type?.coding?.[0]?.code === 'benefit')?.usedMoney?.value,\n        remaining: null\n      };\n      \n      if (benefits[category].allowed && benefits[category].used) {\n        benefits[category].remaining = benefits[category].allowed - benefits[category].used;\n      }\n    });\n    \n    return benefits;\n  }\n\n  /**\n   * Mock eligibility for development\n   */\n  getMockEligibility(patientId) {\n    return {\n      eligible: true,\n      status: 'active',\n      patientId,\n      policyNumber: `POL-${patientId}-2026`,\n      coverageStart: '2026-01-01',\n      coverageEnd: '2026-12-31',\n      payerName: 'Bupa Arabia',\n      payerId: 'INS-BUPA-001',\n      className: 'VIP',\n      benefits: {\n        inpatient: { category: 'inpatient', name: 'Inpatient Services', allowed: 500000, used: 45000, remaining: 455000 },\n        outpatient: { category: 'outpatient', name: 'Outpatient Services', allowed: 50000, used: 5200, remaining: 44800 },\n        dental: { category: 'dental', name: 'Dental Services', allowed: 10000, used: 0, remaining: 10000 },\n        optical: { category: 'optical', name: 'Optical Services', allowed: 5000, used: 0, remaining: 5000 },\n        maternity: { category: 'maternity', name: 'Maternity Coverage', allowed: 30000, used: 0, remaining: 30000 }\n      },\n      coPayPercentage: 20,\n      deductible: 500,\n      deductibleMet: true,\n      errors: []\n    };\n  }\n\n  // ============================================\n  // PRIOR AUTHORIZATION\n  // ============================================\n\n  /**\n   * Submit prior authorization request\n   * @param {Object} params - Authorization request details\n   * @returns {Object} Authorization response\n   */\n  async submitPriorAuth({ patientId, facilityId, sbsCode, diagnosis, description, estimatedAmount, expectedDate }) {\n    await this.setAuthHeader();\n    \n    const priorAuthRequest = this.buildPriorAuthRequest({\n      patientId,\n      facilityId,\n      sbsCode,\n      diagnosis,\n      description,\n      estimatedAmount,\n      expectedDate\n    });\n\n    try {\n      const response = await this.client.post('/Claim', priorAuthRequest);\n      return this.parsePriorAuthResponse(response.data);\n    } catch (error) {\n      console.error('Prior auth submission failed:', error);\n      // Return mock data for development\n      return this.getMockPriorAuth(sbsCode);\n    }\n  }\n\n  /**\n   * Build prior authorization FHIR request\n   */\n  buildPriorAuthRequest({ patientId, facilityId, sbsCode, diagnosis, description, estimatedAmount, expectedDate }) {\n    return {\n      resourceType: 'Claim',\n      id: `pa-${Date.now()}`,\n      status: 'active',\n      type: {\n        coding: [{\n          system: 'http://terminology.hl7.org/CodeSystem/claim-type',\n          code: 'institutional'\n        }]\n      },\n      use: 'preauthorization', // This makes it a prior auth request\n      patient: {\n        reference: `Patient/${patientId}`\n      },\n      created: new Date().toISOString(),\n      provider: {\n        reference: `Organization/${facilityId}`\n      },\n      priority: {\n        coding: [{\n          code: 'normal'\n        }]\n      },\n      diagnosis: diagnosis ? [{\n        sequence: 1,\n        diagnosisCodeableConcept: {\n          coding: [{\n            system: 'http://hl7.org/fhir/sid/icd-10',\n            code: diagnosis\n          }]\n        }\n      }] : [],\n      item: [{\n        sequence: 1,\n        productOrService: {\n          coding: [{\n            system: 'http://chi.gov.sa/sbs',\n            code: sbsCode,\n            display: description\n          }]\n        },\n        servicedDate: expectedDate || new Date().toISOString().split('T')[0],\n        unitPrice: {\n          value: estimatedAmount,\n          currency: 'SAR'\n        }\n      }],\n      total: {\n        value: estimatedAmount,\n        currency: 'SAR'\n      }\n    };\n  }\n\n  /**\n   * Parse prior auth response\n   */\n  parsePriorAuthResponse(fhirResponse) {\n    const outcome = fhirResponse.outcome || 'pending';\n    \n    return {\n      authNumber: fhirResponse.preAuthRef || `PA-${Date.now()}`,\n      status: outcome === 'complete' ? 'approved' : outcome === 'error' ? 'denied' : 'pending',\n      approvedAmount: fhirResponse.payment?.amount?.value,\n      validFrom: fhirResponse.preAuthPeriod?.start,\n      validUntil: fhirResponse.preAuthPeriod?.end,\n      notes: fhirResponse.processNote?.map(n => n.text),\n      denialReason: outcome === 'error' ? fhirResponse.error?.[0]?.code?.text : null\n    };\n  }\n\n  /**\n   * Mock prior auth for development\n   */\n  getMockPriorAuth(sbsCode) {\n    const isApproved = Math.random() > 0.2; // 80% approval rate for mock\n    \n    return {\n      authNumber: `PA-2026-${Math.random().toString(36).substring(7).toUpperCase()}`,\n      status: isApproved ? 'approved' : 'pending',\n      sbsCode,\n      approvedAmount: isApproved ? Math.floor(Math.random() * 50000) + 10000 : null,\n      validFrom: new Date().toISOString().split('T')[0],\n      validUntil: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n      notes: isApproved \n        ? ['Pre-authorization approved. Valid for 30 days.'] \n        : ['Under review. Expected decision within 48 hours.'],\n      denialReason: null\n    };\n  }\n\n  /**\n   * Check prior authorization status\n   */\n  async checkPriorAuthStatus(authNumber) {\n    await this.setAuthHeader();\n    \n    try {\n      const response = await this.client.get(`/Claim?identifier=${authNumber}`);\n      return this.parsePriorAuthResponse(response.data.entry?.[0]?.resource);\n    } catch (error) {\n      console.error('Prior auth status check failed:', error);\n      return this.getMockPriorAuth(authNumber);\n    }\n  }\n\n  // ============================================\n  // CLAIMS SUBMISSION\n  // ============================================\n\n  /**\n   * Submit claim to NPHIES\n   * @param {Object} claim - Claim details\n   * @returns {Object} Claim response\n   */\n  async submitClaim(claim) {\n    await this.setAuthHeader();\n    \n    const fhirClaim = this.buildClaimResource(claim);\n\n    try {\n      const response = await this.client.post('/Claim', fhirClaim);\n      return this.parseClaimResponse(response.data);\n    } catch (error) {\n      console.error('Claim submission failed:', error);\n      return this.getMockClaimResponse(claim);\n    }\n  }\n\n  /**\n   * Build FHIR Claim resource\n   */\n  buildClaimResource(claim) {\n    const items = claim.items.map((item, index) => ({\n      sequence: index + 1,\n      productOrService: {\n        coding: [{\n          system: 'http://chi.gov.sa/sbs',\n          code: item.sbsCode,\n          display: item.description\n        }]\n      },\n      servicedDate: item.serviceDate || claim.serviceDate,\n      quantity: { value: item.quantity || 1 },\n      unitPrice: {\n        value: item.unitPrice,\n        currency: 'SAR'\n      },\n      net: {\n        value: item.netPrice || (item.unitPrice * (item.quantity || 1)),\n        currency: 'SAR'\n      }\n    }));\n\n    return {\n      resourceType: 'Claim',\n      id: claim.claimNumber || `CLM-${Date.now()}`,\n      status: 'active',\n      type: {\n        coding: [{\n          system: 'http://terminology.hl7.org/CodeSystem/claim-type',\n          code: claim.claimType || 'institutional'\n        }]\n      },\n      use: 'claim',\n      patient: {\n        reference: `Patient/${claim.patientId}`\n      },\n      created: new Date().toISOString(),\n      provider: {\n        reference: `Organization/${claim.facilityId}`\n      },\n      priority: {\n        coding: [{ code: 'normal' }]\n      },\n      insurance: [{\n        sequence: 1,\n        focal: true,\n        coverage: {\n          reference: `Coverage/${claim.policyNumber}`\n        }\n      }],\n      diagnosis: claim.diagnoses?.map((d, i) => ({\n        sequence: i + 1,\n        diagnosisCodeableConcept: {\n          coding: [{\n            system: 'http://hl7.org/fhir/sid/icd-10',\n            code: d.code,\n            display: d.display\n          }]\n        }\n      })) || [],\n      item: items,\n      total: {\n        value: claim.totalAmount,\n        currency: 'SAR'\n      }\n    };\n  }\n\n  /**\n   * Parse claim response\n   */\n  parseClaimResponse(fhirResponse) {\n    return {\n      claimId: fhirResponse.id,\n      nphiesReference: fhirResponse.identifier?.[0]?.value,\n      status: this.mapClaimStatus(fhirResponse.outcome),\n      totalSubmitted: fhirResponse.total?.value,\n      totalApproved: fhirResponse.payment?.amount?.value,\n      processedDate: fhirResponse.created,\n      items: fhirResponse.item?.map(item => ({\n        sequence: item.sequence,\n        status: item.adjudication?.find(a => a.category?.coding?.[0]?.code === 'submitted')?.reason?.coding?.[0]?.code,\n        approvedAmount: item.adjudication?.find(a => a.category?.coding?.[0]?.code === 'benefit')?.amount?.value,\n        denialReason: item.adjudication?.find(a => a.category?.coding?.[0]?.code === 'denial')?.reason?.coding?.[0]?.display\n      })),\n      errors: fhirResponse.error?.map(e => e.code?.text) || []\n    };\n  }\n\n  /**\n   * Map FHIR outcome to readable status\n   */\n  mapClaimStatus(outcome) {\n    const statusMap = {\n      'queued': 'submitted',\n      'complete': 'approved',\n      'error': 'rejected',\n      'partial': 'partially_approved'\n    };\n    return statusMap[outcome] || 'pending';\n  }\n\n  /**\n   * Mock claim response for development\n   */\n  getMockClaimResponse(claim) {\n    const statuses = ['approved', 'pending', 'partially_approved'];\n    const status = statuses[Math.floor(Math.random() * statuses.length)];\n    \n    return {\n      claimId: claim.claimNumber || `CLM-${Date.now()}`,\n      nphiesReference: `NPHIES-${Date.now()}-${Math.random().toString(36).substring(7).toUpperCase()}`,\n      status,\n      totalSubmitted: claim.totalAmount,\n      totalApproved: status === 'approved' \n        ? claim.totalAmount \n        : status === 'partially_approved' \n          ? claim.totalAmount * 0.85 \n          : null,\n      processedDate: new Date().toISOString(),\n      items: claim.items?.map((item, index) => ({\n        sequence: index + 1,\n        status: status === 'approved' ? 'approved' : 'pending',\n        approvedAmount: status === 'approved' ? item.netPrice : null,\n        denialReason: null\n      })),\n      errors: []\n    };\n  }\n\n  /**\n   * Check claim status\n   */\n  async checkClaimStatus(claimId) {\n    await this.setAuthHeader();\n    \n    try {\n      const response = await this.client.get(`/ClaimResponse?request=${claimId}`);\n      return this.parseClaimResponse(response.data.entry?.[0]?.resource);\n    } catch (error) {\n      console.error('Claim status check failed:', error);\n      return {\n        claimId,\n        status: 'pending',\n        message: 'Unable to retrieve status. Please try again later.'\n      };\n    }\n  }\n\n  // ============================================\n  // BUNDLE DETECTION\n  // ============================================\n\n  /**\n   * Detect applicable bundles for a set of services\n   * @param {Array} sbsCodes - Array of SBS codes\n   * @returns {Object} Bundle detection result\n   */\n  detectBundles(sbsCodes) {\n    const bundles = this.getAvailableBundles();\n    const applicableBundles = [];\n    \n    bundles.forEach(bundle => {\n      const matchedCodes = bundle.requiredCodes.filter(code => sbsCodes.includes(code));\n      const matchPercentage = (matchedCodes.length / bundle.requiredCodes.length) * 100;\n      \n      if (matchPercentage >= 60) { // 60% match threshold\n        applicableBundles.push({\n          ...bundle,\n          matchedCodes,\n          matchPercentage,\n          savings: this.calculateBundleSavings(sbsCodes, bundle)\n        });\n      }\n    });\n    \n    return {\n      hasApplicableBundles: applicableBundles.length > 0,\n      bundles: applicableBundles,\n      recommendedBundle: applicableBundles.sort((a, b) => b.savings - a.savings)[0] || null\n    };\n  }\n\n  /**\n   * Get available service bundles\n   */\n  getAvailableBundles() {\n    return [\n      {\n        id: 'BUNDLE-KNEE-REPLACE',\n        name: 'Total Knee Replacement Bundle',\n        totalPrice: 45000,\n        requiredCodes: ['49518-00-00', '49518-01-00', '49519-00-00', '92514-00-00', '95550-00-00'],\n        description: 'Complete knee replacement package including surgery, implants, and rehabilitation'\n      },\n      {\n        id: 'BUNDLE-CARDIAC-CATH',\n        name: 'Cardiac Catheterization Bundle',\n        totalPrice: 25000,\n        requiredCodes: ['38200-00-00', '38203-00-00', '38218-00-00', '11700-00-00'],\n        description: 'Diagnostic cardiac catheterization with angiography'\n      },\n      {\n        id: 'BUNDLE-LAPCHOL',\n        name: 'Laparoscopic Cholecystectomy Bundle',\n        totalPrice: 15000,\n        requiredCodes: ['30443-00-00', '30445-00-00', '92514-00-00'],\n        description: 'Gallbladder removal surgery package'\n      },\n      {\n        id: 'BUNDLE-APPENDIX',\n        name: 'Appendectomy Bundle',\n        totalPrice: 12000,\n        requiredCodes: ['30571-00-00', '30572-00-00', '92514-00-00'],\n        description: 'Appendix removal surgery package'\n      },\n      {\n        id: 'BUNDLE-MATERNITY',\n        name: 'Normal Delivery Package',\n        totalPrice: 12000,\n        requiredCodes: ['16520-00-00', '16520-01-00', '90761-00-00'],\n        description: 'Standard vaginal delivery with routine care'\n      }\n    ];\n  }\n\n  /**\n   * Calculate potential savings with bundle\n   */\n  calculateBundleSavings(sbsCodes, bundle) {\n    // Estimate individual pricing (simplified)\n    const estimatedIndividual = sbsCodes.length * 5000; // Rough estimate\n    return Math.max(0, estimatedIndividual - bundle.totalPrice);\n  }\n}\n\n// Export singleton instance\nexport const nphiesService = new NPHIESService();\n\n// Export class for testing\nexport { NPHIESService };\n"],"names":["NPHIES_CONFIG","NPHIESService","axios","error","token","patientId","insurerId","policyNumber","serviceDate","eligibilityRequest","response","fhirResponse","e","items","benefits","item","category","b","facilityId","sbsCode","diagnosis","description","estimatedAmount","expectedDate","priorAuthRequest","outcome","n","isApproved","authNumber","claim","fhirClaim","index","d","statuses","status","claimId","sbsCodes","bundles","applicableBundles","bundle","matchedCodes","code","matchPercentage","a","estimatedIndividual","nphiesService"],"mappings":"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"}