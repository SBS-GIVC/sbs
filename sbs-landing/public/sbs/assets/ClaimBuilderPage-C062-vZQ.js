import{r as n,j as e}from"./vendor-react-MVSD7VGK.js";import{n as re}from"./nphiesService-CN9naE0r.js";import{aiAssistant as T}from"./aiAssistantService-BWORHkI6.js";import{i as F,u as Ie}from"./main-DTZYqsTu.js";import{B as y}from"./Button-BDY0gMZ-.js";import{C as v,a as D,b as w}from"./Card-CNl4AdZD.js";import{S as Pe}from"./SectionHeader-BFZqpzku.js";import"./vendor-BW1Bdpst.js";function ze({lang:P="en"}){const l=(F[P]||F.en).pages?.claimBuilder||F.en.pages.claimBuilder,[j,A]=n.useState(1),[a,p]=n.useState({patientId:"",patientName:"",userEmail:"",facilityId:"FAC001",policyNumber:"",serviceDate:new Date().toISOString().split("T")[0],claimType:"institutional",diagnoses:[],items:[],bundleApplied:!1,bundleId:null}),[o,k]=n.useState({sbsCode:"",description:"",quantity:1,unitPrice:0}),[E,C]=n.useState([]),[U,S]=n.useState(!1),[ne,M]=n.useState(!1),[Q,q]=n.useState(null),[Ee,de]=n.useState(null),[ce,oe]=n.useState(null),[Re,ue]=n.useState([]),[h,z]=n.useState(null),[I,O]=n.useState(!1),[me,V]=n.useState(!1),[xe,L]=n.useState(!1),[H,pe]=n.useState(null),[_e,Be]=n.useState(null),u=Ie(),[N,$]=n.useState({identity:!1,item:!1}),[b,f]=n.useState({patientId:!1,userEmail:!1,itemSbsCode:!1,itemQuantity:!1,itemUnitPrice:!1}),G=n.useRef(null),J=n.useRef(null),Y=n.useRef(null),W=t=>{const s=String(t||"").trim();return s?/^[0-9]{10}$/.test(s)?null:l.validation.patientIdInvalid:l.validation.patientIdRequired},X=t=>{const s=String(t||"").trim();return s?/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(s)?null:l.validation.emailInvalid:null},K=t=>{const s=String(t||"").trim();return s?s.length<2?P==="ar"?"Ø£Ø¯Ø®Ù„ Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø¨Ø­Ø«.":"Enter at least 2 characters to search.":null:l.validation.itemCodeRequired},Z=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?l.validation.qtyInvalid:null},ee=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?l.validation.priceInvalid:null},d=n.useMemo(()=>({patientId:N.identity||b.patientId?W(a.patientId):null,userEmail:N.identity||b.userEmail?X(a.userEmail):null,itemSbsCode:N.item||b.itemSbsCode?K(o.sbsCode):null,itemQuantity:N.item||b.itemQuantity?Z(o.quantity):null,itemUnitPrice:N.item||b.itemUnitPrice?ee(o.unitPrice):null}),[N.identity,N.item,b.patientId,b.userEmail,b.itemSbsCode,b.itemQuantity,b.itemUnitPrice,a.patientId,a.userEmail,o.sbsCode,o.quantity,o.unitPrice]),R=n.useCallback(t=>{const s=String(t?.code||t?.sbsCode||t?.sbs_code||"").trim();if(!s)return;const i=String(t?.description||t?.desc||t?.official_description||"").trim(),r=Number(t?.fee||t?.unitPrice||0);k(c=>({...c,sbsCode:s,description:i||c.description||"",unitPrice:Number.isFinite(r)?r:c.unitPrice})),S(!1),C([]),u.info(`${l.toast.stagedLoaded}: ${s}`)},[u,l.toast.stagedLoaded]);n.useEffect(()=>{if(typeof window>"u")return;const t=i=>{try{return i.getItem("sbs_claim_context_code")}catch{return null}},s=t(window.sessionStorage)||t(window.localStorage);if(s)try{const i=JSON.parse(s);R(i)}catch{}finally{try{window.sessionStorage.removeItem("sbs_claim_context_code")}catch{}try{window.localStorage.removeItem("sbs_claim_context_code")}catch{}}},[R]),n.useEffect(()=>{if(typeof window>"u")return;const t=s=>R(s?.detail);return window.addEventListener("sbs:claim-context",t),()=>window.removeEventListener("sbs:claim-context",t)},[R]);const be=t=>{const s=t?.confidence;if(typeof s=="number"&&Number.isFinite(s))return Math.max(0,Math.min(1,s));const i=t?.score;return typeof i=="number"&&Number.isFinite(i)?Math.max(.35,Math.min(.92,i/100)):.55},te=E?.[0]?.code||"",_=a.items.reduce((t,s)=>t+(s.netPrice||0),0),m=ce?.recommendedBundle||null,se=m?Math.max(0,_-m.totalPrice):0,he=_>0?Math.round(se/_*100):0,fe=()=>{m&&(p(t=>({...t,bundleApplied:!0,bundleId:m.id})),u.success(`${l.toast.bundleApplied}: ${m.name}`))},ge=()=>{p(t=>({...t,bundleApplied:!1,bundleId:null})),u.info(l.toast.bundleCleared)},ye=async()=>{$(i=>({...i,identity:!0}));const t=W(a.patientId),s=X(a.userEmail);if(t||s){f(i=>({...i,patientId:!0,userEmail:!0})),u.warning(t||s||l.toast.fixFields),t?G.current?.focus?.():s&&J.current?.focus?.();return}V(!0);try{const i=await re.checkEligibility({patientId:a.patientId,insurerId:"INS-AUTO",policyNumber:a.policyNumber||`POL-${a.patientId}`,serviceDate:a.serviceDate});de(i),p(r=>({...r,policyNumber:i.policyNumber})),i.eligible?(u.success(l.toast.eligible),A(2)):u.error(l.toast.ineligible)}catch{u.error(l.toast.verifyFail)}finally{V(!1)}},ve=n.useCallback(async t=>{if(k(s=>({...s,sbsCode:t})),t.length>=2){M(!0);try{const s=await T.smartSearch(t,{limit:10,includeAI:!0});C(s.results),S(!0),s.aiInsights&&q(s.aiInsights)}catch{try{const i=await T.smartSearch(t,{limit:10,includeAI:!1});C(i.results),S(!0)}catch{C([]),S(!1),u.warning(l.toast.searchUnavailable)}}finally{M(!1)}}else C([]),S(!1),q(null)},[]),je=t=>{k({sbsCode:t.code,description:t.desc,quantity:1,unitPrice:t.fee||250}),S(!1),q(null)},Ne=()=>{$(x=>({...x,item:!0}));const t=K(o.sbsCode),s=Z(o.quantity),i=ee(o.unitPrice);if(t||s||i){f(x=>({...x,itemSbsCode:!0,itemQuantity:!0,itemUnitPrice:!0})),u.warning(t||s||i||l.toast.fixFields),t&&Y.current?.focus?.();return}const r={...o,sequence:a.items.length+1,netPrice:o.quantity*o.unitPrice},c=[...a.items,r];p(x=>({...x,items:c})),k({sbsCode:"",description:"",quantity:1,unitPrice:0}),$(x=>({...x,item:!1})),f(x=>({...x,itemSbsCode:!1,itemQuantity:!1,itemUnitPrice:!1})),ae(c),ke(r),le(c)},we=t=>{const s=a.items.filter((i,r)=>r!==t);p(i=>({...i,items:s})),ae(s),s.length>0?le(s):z(null)},ae=t=>{const s=t.map(c=>c.sbsCode),i=re.detectBundles(s);if(oe(i.hasApplicableBundles?i:null),!i.hasApplicableBundles){p(c=>c.bundleApplied?{...c,bundleApplied:!1,bundleId:null}:c);return}const r=i.recommendedBundle?.id||null;r&&p(c=>c.bundleApplied&&c.bundleId&&c.bundleId!==r?{...c,bundleApplied:!1,bundleId:null}:c)},ke=t=>{const s=["49518","38200","39703","38218","30443","30571"],i=t.sbsCode.split("-")[0];(s.includes(i)||t.unitPrice>5e3)&&ue(r=>[...r,t.sbsCode])},le=async t=>{O(!0);try{const s=await T.validateClaim({...a,items:t});z(s)}finally{O(!1)}},B=()=>a.bundleApplied&&m?m.totalPrice:a.items.reduce((t,s)=>t+s.netPrice,0),Se=async()=>{L(!0);try{const t={patientName:a.patientName,patientId:a.patientId,memberId:a.patientId,claimType:a.claimType,userEmail:a.userEmail,facilityId:a.facilityId,services:a.items.map(r=>({internalCode:r.sbsCode,sbsCode:r.sbsCode,description:r.description,quantity:r.quantity,unitPrice:r.unitPrice,serviceDate:r.serviceDate||a.serviceDate})),servicesTotal:B()},s=await fetch("/api/submit-claim-enhanced",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=await s.json();if(!s.ok||!i?.success)throw new Error(i?.error||i?.message||`Submission failed (HTTP ${s.status})`);pe(i),A(4),u.success(l.toast.submitted)}catch(t){u.error(t?.message||l.toast.submissionFailed)}finally{L(!1)}},g=t=>new Intl.NumberFormat(P==="ar"?"ar-SA":"en-SA",{style:"currency",currency:"SAR",minimumFractionDigits:0}).format(t);return e.jsx("div",{className:"flex-1",children:e.jsxs("main",{className:"max-w-[1400px] mx-auto p-6 sm:p-8 space-y-8 stagger-children",children:[e.jsxs("section",{className:"animate-premium-in",children:[e.jsx(Pe,{title:l.header.title,subtitle:l.header.subtitle,badge:l.header.badge}),e.jsxs("div",{className:"mt-10 mb-2 relative flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx("div",{className:"absolute top-1/2 left-0 right-0 h-1 bg-slate-200 dark:bg-slate-800 -translate-y-1/2 rounded-full"}),e.jsx("div",{className:"absolute top-1/2 left-0 h-1 bg-blue-600 -translate-y-1/2 rounded-full transition-all duration-700",style:{width:`${(j-1)/3*100}%`}}),[{n:1,icon:"person_search",label:l.steps.identity},{n:2,icon:"add_task",label:l.steps.services},{n:3,icon:"fact_check",label:l.steps.review},{n:4,icon:"check_circle",label:l.steps.relayed}].map(t=>e.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-2",children:[e.jsx("div",{className:`size-12 rounded-2xl flex items-center justify-center transition-all duration-500 shadow-xl ${j>=t.n?"bg-blue-600 text-white scale-110 shadow-blue-600/20":"bg-white dark:bg-slate-800 text-slate-400"}`,children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-2xl",children:t.icon})}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${j>=t.n?"text-blue-600":"text-slate-400"}`,children:t.label})]},t.n))]})]}),e.jsxs("div",{className:"min-h-[600px]",children:[j===1&&e.jsxs(v,{className:"max-w-4xl mx-auto animate-premium-in shadow-2xl",children:[e.jsx(D,{title:l.identity.title,subtitle:l.identity.subtitle}),e.jsx(w,{children:e.jsxs("form",{className:"grid md:grid-cols-2 gap-8",onSubmit:t=>{t.preventDefault(),ye()},noValidate:!0,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{htmlFor:"claimbuilder-patient-id",className:"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1",children:[l.identity.patientId," ",e.jsxs("span",{"aria-hidden":"true",className:"text-rose-500",children:[" ","*"]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600",children:"fingerprint"}),e.jsx("input",{ref:G,type:"text",id:"claimbuilder-patient-id",className:`w-full pl-12 pr-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold focus:outline-none focus:ring-2 ${d.patientId?"border-rose-500/60 dark:border-rose-500/50 focus:ring-rose-500/20":"border-slate-200 dark:border-slate-800 focus:ring-blue-600/20"}`,placeholder:"Enter Saudi ID / Iqama",value:a.patientId,"data-testid":"claimbuilder-patient-id",inputMode:"numeric",pattern:"[0-9]{10}",required:!0,"aria-invalid":!!d.patientId,"aria-describedby":d.patientId?"claimbuilder-patient-id-error":void 0,onBlur:()=>f(t=>({...t,patientId:!0})),onChange:t=>p({...a,patientId:t.target.value})})]}),d.patientId&&e.jsx("p",{id:"claimbuilder-patient-id-error",role:"alert",className:"text-[11px] font-semibold text-rose-600 ml-1",children:d.patientId})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{htmlFor:"claimbuilder-patient-name",className:"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1",children:l.identity.patientName}),e.jsx("input",{type:"text",id:"claimbuilder-patient-name",className:"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20",placeholder:"e.g. Fadil Ahmad",value:a.patientName,onChange:t=>p({...a,patientName:t.target.value})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{htmlFor:"claimbuilder-user-email",className:"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1",children:l.identity.email}),e.jsx("input",{ref:J,type:"email",id:"claimbuilder-user-email",className:`w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold focus:outline-none focus:ring-2 ${d.userEmail?"border-rose-500/60 dark:border-rose-500/50 focus:ring-rose-500/20":"border-slate-200 dark:border-slate-800 focus:ring-blue-600/20"}`,placeholder:"billing-notifications@provider.com",value:a.userEmail,"aria-invalid":!!d.userEmail,"aria-describedby":d.userEmail?"claimbuilder-user-email-error":void 0,onBlur:()=>f(t=>({...t,userEmail:!0})),onChange:t=>p({...a,userEmail:t.target.value})}),d.userEmail&&e.jsx("p",{id:"claimbuilder-user-email-error",role:"alert",className:"text-[11px] font-semibold text-rose-600 ml-1",children:d.userEmail})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{htmlFor:"claimbuilder-service-date",className:"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1",children:l.identity.serviceDate}),e.jsx("input",{type:"date",id:"claimbuilder-service-date",className:"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20",value:a.serviceDate,onChange:t=>p({...a,serviceDate:t.target.value})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{htmlFor:"claimbuilder-claim-type",className:"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1",children:l.identity.claimType}),e.jsxs("select",{id:"claimbuilder-claim-type",className:"w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-600/20 appearance-none pointer-events-auto",value:a.claimType,onChange:t=>p({...a,claimType:t.target.value}),children:[e.jsx("option",{value:"institutional",children:"Institutional"}),e.jsx("option",{value:"professional",children:"Professional"}),e.jsx("option",{value:"pharmacy",children:"Pharmacy"}),e.jsx("option",{value:"vision",children:"Vision"})]})]})]})]}),e.jsxs("div",{className:"md:col-span-2 pt-6 border-t border-slate-100 dark:border-slate-800",children:[e.jsx(y,{type:"submit",loading:me,icon:"verified",className:"w-full py-4 rounded-2xl","data-testid":"claimbuilder-validate-identity",children:l.identity.proceed}),e.jsxs("p",{className:"mt-4 text-[11px] font-semibold text-slate-500",children:[l.identity.consent," ",e.jsx("button",{type:"button",onClick:()=>window.dispatchEvent(new CustomEvent("sbs:navigate",{detail:{view:"privacy"}})),className:"underline underline-offset-4 hover:text-blue-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white",children:P==="ar"?"Ø¹Ø±Ø¶ Ø§Ù„Ø®ØµÙˆØµÙŠØ©":"View privacy"})]})]})]})})]}),j===2&&e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8 animate-premium-in",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(v,{children:[e.jsx(D,{title:l.services.title,subtitle:l.services.subtitle}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"relative space-y-2",children:[e.jsxs("label",{htmlFor:"claimbuilder-item-sbs",className:"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1",children:[l.services.code," ",e.jsxs("span",{"aria-hidden":"true",className:"text-rose-500",children:[" ","*"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",children:"search"}),e.jsx("input",{ref:Y,type:"text",id:"claimbuilder-item-sbs",role:"combobox","aria-autocomplete":"list","aria-expanded":U&&E.length>0,"aria-controls":"claimbuilder-sbs-suggestions","aria-invalid":!!d.itemSbsCode,"aria-describedby":d.itemSbsCode?"claimbuilder-item-sbs-error":void 0,className:`w-full pl-12 pr-12 py-4 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold focus:outline-none focus:ring-2 ${d.itemSbsCode?"border-rose-500/60 dark:border-rose-500/50 focus:ring-rose-500/20":"border-slate-200 dark:border-slate-800 focus:ring-blue-600/20"}`,placeholder:"Search by code or describe in natural language...",value:o.sbsCode,"data-testid":"claimbuilder-item-sbs",required:!0,onBlur:()=>f(t=>({...t,itemSbsCode:!0})),onChange:t=>ve(t.target.value)}),ne&&e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 animate-spin text-blue-600",children:"progress_activity"})]}),U&&E.length>0&&e.jsxs("div",{id:"claimbuilder-sbs-suggestions",role:"listbox",className:"absolute z-50 w-full mt-2 glass-panel border border-slate-200/50 dark:border-slate-700/50 rounded-2xl shadow-2xl max-h-72 overflow-y-auto overflow-x-hidden",children:[Q&&e.jsxs("div",{className:"px-5 py-2.5 bg-blue-600 font-bold text-white text-[11px] flex items-center gap-2",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-sm",children:"auto_awesome"})," ",Q]}),E.map((t,s)=>(()=>{const i=be(t),r=Math.round(i*100),c=te&&t.code===te,x=t.aiReason||t.aiReasoning||t.reason||"",ie=t.source==="ai"||typeof t.confidence=="number";return e.jsxs("button",{type:"button",role:"option",onMouseDown:Ce=>{Ce.preventDefault(),je(t)},"data-testid":c?"sbs-suggestion-top-pick":`sbs-suggestion-${s}`,className:`px-5 py-4 cursor-pointer border-b border-slate-100 dark:border-slate-800 last:border-0 group/item transition-colors ${c?"bg-gradient-to-r from-blue-600/10 to-emerald-500/10 hover:from-blue-600/15 hover:to-emerald-500/15 border-l-4 border-l-blue-600":"hover:bg-slate-100 dark:hover:bg-slate-800"} focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm font-black text-blue-600 bg-blue-600/10 px-2.5 py-1 rounded-lg border border-blue-600/20",children:t.code}),c&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-gradient-to-r from-blue-600 to-emerald-500 text-white text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-600/30 animate-pulse",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-[14px]",children:"auto_awesome"}),"ðŸŒŸ AI Top Pick"]}),ie&&!c&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border border-emerald-500/30 text-[10px] font-black uppercase tracking-widest shadow-sm",title:"AI-enhanced suggestion",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-[12px]",children:"smart_toy"}),"AI"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("div",{className:"relative h-6 w-28 rounded-full bg-slate-200/80 dark:bg-slate-800/80 overflow-hidden border-2 border-slate-300/70 dark:border-slate-700/60 shadow-inner",title:`${ie?"AI confidence":"Match score"}: ${r}%`,children:[e.jsx("div",{className:`h-full transition-all duration-500 ${r>=80?"bg-gradient-to-r from-emerald-500 to-green-600":r>=60?"bg-gradient-to-r from-blue-500 to-blue-600":"bg-gradient-to-r from-amber-500 to-orange-500"}`,style:{width:`${r}%`}}),e.jsxs("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-[11px] font-black text-slate-900/90 dark:text-white/90 drop-shadow",children:[r,"%"]})]}),e.jsxs("span",{className:"text-[9px] font-bold uppercase text-slate-400",children:[r>=80?"ðŸŽ¯ Excellent":r>=60?"ðŸ‘ Good":"âš ï¸ Fair"," Match"]})]}),e.jsx("span",{className:"text-[10px] font-black uppercase text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded",children:t.category||"â€”"})]})]}),e.jsx("p",{className:"mt-2 text-sm font-extrabold text-slate-700 dark:text-slate-200",children:t.desc}),x&&e.jsxs("div",{className:"mt-3 flex items-start gap-3 p-3.5 rounded-xl bg-gradient-to-r from-blue-600/8 to-purple-600/8 dark:from-blue-600/12 dark:to-purple-600/12 border-2 border-blue-600/20 shadow-sm",title:x,children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-blue-600 text-white shadow-lg flex-shrink-0",children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-base",children:"psychology"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[9px] font-black uppercase tracking-widest text-blue-700 dark:text-blue-400 mb-1",children:"ðŸ’¡ AI Reasoning"}),e.jsx("p",{className:"text-xs font-semibold text-slate-700 dark:text-slate-300 leading-relaxed",children:x})]})]})]},s)})())]}),d.itemSbsCode&&e.jsx("p",{id:"claimbuilder-item-sbs-error",role:"alert",className:"text-[11px] font-semibold text-rose-600 ml-1",children:d.itemSbsCode})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:l.services.qty}),e.jsx("input",{type:"number",className:`w-full px-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold ${d.itemQuantity?"border-rose-500/60 dark:border-rose-500/50":"border-slate-200 dark:border-slate-800"}`,value:o.quantity,"data-testid":"claimbuilder-item-qty",min:"1",required:!0,"aria-invalid":!!d.itemQuantity,"aria-describedby":d.itemQuantity?"claimbuilder-item-qty-error":void 0,onBlur:()=>f(t=>({...t,itemQuantity:!0})),onChange:t=>k({...o,quantity:Number(t.target.value)})}),d.itemQuantity&&e.jsx("p",{id:"claimbuilder-item-qty-error",role:"alert",className:"text-[11px] font-semibold text-rose-600 ml-1 mt-1",children:d.itemQuantity})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1",children:l.services.unitPrice}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold",children:"SAR"}),e.jsx("input",{type:"number",className:`w-full pl-14 pr-4 py-3.5 bg-slate-50 dark:bg-slate-900/50 border rounded-2xl font-bold ${d.itemUnitPrice?"border-rose-500/60 dark:border-rose-500/50":"border-slate-200 dark:border-slate-800"}`,value:o.unitPrice,"data-testid":"claimbuilder-item-unitprice",min:"1",required:!0,"aria-invalid":!!d.itemUnitPrice,"aria-describedby":d.itemUnitPrice?"claimbuilder-item-unitprice-error":void 0,onBlur:()=>f(t=>({...t,itemUnitPrice:!0})),onChange:t=>k({...o,unitPrice:Number(t.target.value)})})]}),d.itemUnitPrice&&e.jsx("p",{id:"claimbuilder-item-unitprice-error",role:"alert",className:"text-[11px] font-semibold text-rose-600 ml-1 mt-1",children:d.itemUnitPrice})]})]}),e.jsx(y,{variant:"secondary",className:"w-full py-4 rounded-2xl border-dashed",onClick:Ne,icon:"add_box","data-testid":"claimbuilder-add-item",children:l.services.add})]})]}),a.items.length>0&&e.jsxs(v,{children:[e.jsx(D,{title:l.services.payloadTitle,action:e.jsx("span",{className:"text-xl font-black text-blue-600",children:g(B())})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500",children:l.services.serviceInfo}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500 text-right",children:l.services.netPrice}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:a.items.map((t,s)=>e.jsxs("tr",{className:"group hover:bg-slate-50/50 dark:hover:bg-slate-800/20 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-xs font-black bg-blue-600/10 text-blue-600 px-2 py-0.5 rounded",children:t.sbsCode}),e.jsx("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-200",children:t.description})]}),e.jsxs("p",{className:"text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest",children:[t.quantity," Unit Ã— ",g(t.unitPrice)]})]}),e.jsx("td",{className:"px-6 py-4 text-right font-black text-slate-900 dark:text-white",children:g(t.netPrice)}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{type:"button",onClick:()=>we(s),className:"p-2 text-slate-300 hover:text-rose-500 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900","aria-label":`Remove service ${t.sbsCode}`,children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-lg",children:"delete"})})})]},s))})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[(h||I)&&e.jsx(v,{className:`border-l-4 transition-colors ${I?"border-l-blue-600 animate-pulse":h?.errors?.length>0?"border-l-rose-500":"border-l-emerald-500 shadow-emerald-500/10"}`,children:e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{"aria-hidden":"true",className:`material-symbols-outlined font-black ${I?"text-blue-600":h?.errors?.length>0?"text-rose-500":"text-emerald-500"}`,children:I?"sync":h?.errors?.length>0?"report":"verified"}),e.jsx("h4",{className:"text-sm font-black uppercase tracking-widest text-slate-900 dark:text-white",children:"AI Compliance Agent"})]}),h?.errors?.map((t,s)=>e.jsxs("div",{className:"p-3 bg-rose-500/10 border border-rose-500/20 rounded-xl text-xs font-bold text-rose-600 flex gap-2",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-xs",children:"close"})," ",t]},s)),h?.warnings?.map((t,s)=>e.jsxs("div",{className:"p-3 bg-amber-500/10 border border-amber-500/20 rounded-xl text-xs font-bold text-amber-600 flex gap-2",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-xs",children:"warning"})," ",t]},s)),h?.suggestions?.map((t,s)=>e.jsxs("div",{className:"p-4 glass-panel border border-blue-600/20 rounded-2xl space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-blue-600 text-sm",children:"auto_awesome"}),e.jsx("p",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 leading-relaxed",children:t.reason||t.name})]}),e.jsx("button",{onClick:()=>u.info("Optimizing..."),className:"w-full py-2 bg-blue-600 text-white text-[10px] font-black uppercase tracking-widest rounded-lg shadow-lg shadow-blue-600/20 transition-transform active:scale-95",children:"Optimize with Agent"})]},s)),!I&&!h?.errors?.length&&a.items.length>0&&e.jsx("div",{className:"text-center py-4 bg-emerald-500/5 rounded-2xl border border-emerald-500/10",children:e.jsx("p",{className:"text-xs font-black text-emerald-600 uppercase tracking-widest",children:"Compliance Guaranteed"})})]})}),m&&a.items.length>0&&e.jsxs(v,{className:"border-2 border-amber-500/40 bg-gradient-to-br from-amber-50 via-orange-50/50 to-amber-100/80 dark:from-amber-500/10 dark:to-orange-500/5 shadow-2xl shadow-amber-500/20 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_120%,rgba(251,191,36,0.1),transparent_50%)] pointer-events-none"}),e.jsxs(w,{className:"space-y-5 relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-amber-500 text-4xl animate-pulse",children:"redeem"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-emerald-500 rounded-full animate-ping"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-[11px] font-black uppercase tracking-widest text-amber-600",children:"ðŸŽ Bundle Opportunity"}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500 text-white text-[9px] font-black uppercase tracking-widest",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-[12px]",children:"auto_awesome"}),"AI Detected"]})]}),e.jsx("div",{className:"text-base font-black text-slate-900 dark:text-white",children:m.name})]})]}),e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest px-3 py-1.5 rounded-full border-2 border-amber-500/40 bg-white/90 dark:bg-slate-900/60 text-amber-700 dark:text-amber-400 shadow-lg",title:"Match percentage based on required codes detected in your session",children:[Math.round(m.matchPercentage||0),"% match"]})]}),e.jsx("p",{className:"text-xs font-semibold text-slate-700 dark:text-slate-300 leading-relaxed",children:m.description}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-3xl text-emerald-600 drop-shadow-lg animate-bounce",children:"trending_flat"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-emerald-700 bg-white/90 dark:bg-slate-900/80 px-2 py-0.5 rounded-full border border-emerald-500/30",children:"Save"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-5 bg-white/90 dark:bg-slate-900/50 border-2 border-slate-300/80 dark:border-slate-700/60 rounded-2xl shadow-lg relative",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 mb-1",children:"Individual Codes"}),e.jsx("div",{className:"text-2xl font-black text-slate-900 dark:text-white",children:g(_)}),e.jsx("div",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-wider mt-1",children:"Standard Pricing"})]}),e.jsxs("div",{className:"p-5 bg-gradient-to-br from-emerald-500/20 to-blue-600/20 border-2 border-emerald-500/40 rounded-2xl shadow-xl relative",children:[e.jsx("div",{className:"absolute -top-2 -right-2 bg-emerald-600 text-white text-[8px] font-black uppercase px-2 py-1 rounded-full shadow-lg",children:"Best Value"}),e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-emerald-700 dark:text-emerald-400 mb-1",children:"Bundle Price"}),e.jsx("div",{className:"text-2xl font-black text-emerald-700 dark:text-emerald-400",children:g(m.totalPrice)}),e.jsx("div",{className:"text-[9px] font-bold text-emerald-600 dark:text-emerald-500 uppercase tracking-wider mt-1",children:"Optimized Rate"})]})]})]}),e.jsxs("div",{className:"p-4 rounded-2xl bg-gradient-to-r from-emerald-500/20 to-green-500/20 border-2 border-emerald-500/40 flex items-center justify-between gap-3 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-emerald-600 text-white shadow-lg",children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-xl",children:"savings"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-emerald-800 dark:text-emerald-300",children:"You Save"}),e.jsxs("div",{className:"text-lg font-black text-emerald-700 dark:text-emerald-400",children:[g(se)," ",e.jsxs("span",{className:"text-sm",children:["(",he,"%)"]})]})]})]}),a.bundleApplied?e.jsxs("span",{className:"flex items-center gap-1.5 text-[10px] font-black uppercase tracking-widest px-3 py-1.5 rounded-full bg-emerald-600 text-white shadow-lg",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-sm",children:"check_circle"}),"Applied"]}):e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 px-3 py-1.5 bg-white/50 dark:bg-slate-800/50 rounded-full",children:"Optional"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(y,{variant:a.bundleApplied?"secondary":"success",className:"flex-1 py-4 rounded-2xl text-base font-black shadow-xl hover:shadow-2xl transition-all duration-200 hover:scale-[1.02]",onClick:a.bundleApplied?ge:fe,icon:a.bundleApplied?"undo":"auto_fix_high","data-testid":"claimbuilder-apply-bundle",children:a.bundleApplied?"â†©ï¸ Clear Bundle":`âœ¨ Apply ${m.name} Bundle`})}),e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-xl bg-blue-600/5 dark:bg-blue-600/10 border border-blue-600/10",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-blue-600 text-sm",children:"psychology"}),e.jsxs("p",{className:"text-[10px] font-semibold text-slate-600 dark:text-slate-300 leading-relaxed",children:[e.jsx("strong",{children:"AI Recommendation:"})," This bundle was automatically detected based on your selected services. Applying it will optimize your claim for faster approval and maximum reimbursement."]})]})]})]}),e.jsx(v,{className:"bg-slate-900 text-white shadow-2xl",children:e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Total Adjudicated Amount"}),e.jsx("h3",{className:"text-4xl font-black tracking-tighter text-blue-500",children:g(B())})]}),e.jsxs("div",{className:"space-y-3 pt-6 border-t border-white/10",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold text-slate-400",children:[e.jsx("span",{children:"Patient Coverage"}),e.jsx("span",{className:"text-emerald-500",children:"92% Cover"})]}),e.jsxs("div",{className:"flex justify-between text-xs font-bold text-slate-400",children:[e.jsx("span",{children:"Taxes / VAT"}),e.jsx("span",{children:"SAR 0.00"})]})]}),e.jsx(y,{className:"w-full py-4 rounded-2xl",onClick:()=>A(3),"data-testid":"claimbuilder-proceed-review",children:"Proceed to Review"})]})})]})]}),j===3&&e.jsxs(v,{className:"max-w-3xl mx-auto animate-premium-in shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-12 text-center space-y-6 bg-slate-900 text-white",children:[e.jsx("div",{className:"size-20 bg-blue-600 rounded-[28px] flex items-center justify-center mx-auto shadow-2xl shadow-blue-600/40",children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-4xl",children:"fact_check"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-4xl font-black tracking-tighter",children:"Final Verification"}),e.jsx("p",{className:"text-slate-400 font-bold uppercase tracking-widest text-xs",children:"Review the operational payload before national relay"})]})]}),e.jsxs(w,{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 pb-8 border-b border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-400",children:"Relaying to"}),e.jsx("p",{className:"text-lg font-black text-slate-800 dark:text-white",children:"NPHIES Production"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-400",children:"Claim Value"}),e.jsx("p",{className:"text-lg font-black text-blue-600",children:g(B())})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-slate-400 text-center",children:"Security Check"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-emerald-500",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-sm",children:"shield"})," Digital Signature Ready"]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-emerald-500",children:[e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-sm",children:"lock"})," RSA-2048 Active"]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(y,{variant:"secondary",className:"flex-1 py-4",onClick:()=>A(2),children:"Modify Session"}),e.jsx(y,{loading:xe,icon:"bolt",className:"flex-[2] py-4",onClick:Se,"data-testid":"claimbuilder-submit",children:"Sign & Submit to NPHIES"})]})]})]}),j===4&&e.jsxs("div",{className:"max-w-2xl mx-auto text-center space-y-8 animate-premium-in py-12",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"size-32 bg-emerald-500 rounded-[40px] flex items-center justify-center mx-auto shadow-2xl shadow-emerald-500/20 scale-110",children:e.jsx("span",{"aria-hidden":"true",className:"material-symbols-outlined text-6xl text-white",children:"verified"})}),e.jsx("div",{className:"absolute inset-x-0 bottom-[-10px] flex justify-center",children:e.jsx("span",{className:"px-4 py-1.5 bg-slate-900 border border-slate-800 text-white rounded-full text-[10px] font-black uppercase tracking-widest shadow-xl",children:"Transmission Success"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-4xl font-black tracking-tighter text-slate-900 dark:text-white",children:"Claim Successfully Relayed"}),e.jsx("p",{className:"text-slate-500 font-bold max-w-sm mx-auto leading-relaxed",children:"Your claim has been normalized, signed and accepted by the national integration gateway."})]}),e.jsx(v,{className:"bg-slate-50 dark:bg-slate-900/40 border-slate-200/50 dark:border-slate-800/50",children:e.jsxs(w,{className:"space-y-4 text-left",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm font-bold",children:[e.jsx("span",{className:"text-slate-400 uppercase tracking-widest text-[10px]",children:"Reference ID"}),e.jsx("code",{className:"text-blue-600 font-mono","data-testid":"claimbuilder-reference",children:H?.claimId||"CLM-88234-X"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm font-bold",children:[e.jsx("span",{className:"text-slate-400 uppercase tracking-widest text-[10px]",children:"Relay Status"}),e.jsx("span",{className:"text-emerald-500 uppercase",children:"Accepted"})]})]})}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[e.jsx(y,{icon:"receipt",onClick:()=>window.open(H?.trackingUrl,"_blank"),children:"Download NPHIES Receipt"}),e.jsx(y,{variant:"secondary",icon:"refresh",onClick:()=>window.location.reload(),children:"Build Another Claim"})]})]})]})]})})}export{ze as ClaimBuilderPage};
//# sourceMappingURL=ClaimBuilderPage-C062-vZQ.js.map
