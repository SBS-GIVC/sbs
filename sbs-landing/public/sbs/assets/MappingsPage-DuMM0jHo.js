import{r as m,j as e}from"./vendor-react-MVSD7VGK.js";import{C as b,a as v,b as j}from"./Card-CNl4AdZD.js";import{S as E}from"./SectionHeader-BFZqpzku.js";import{B as N}from"./Button-BDY0gMZ-.js";import{A as I}from"./apiService-D97cca7l.js";import{u as z,i as y}from"./main-DTZYqsTu.js";import"./vendor-BW1Bdpst.js";function Q({lang:s="en"}){const a=z(),t=(y[s]||y.en).pages?.mappings||y.en.pages.mappings,[n,d]=m.useState(!0),[l,g]=m.useState(null),[u,M]=m.useState(null),[L,S]=m.useState(0);m.useEffect(()=>{let r=!1;const c=async()=>{try{const p=await I.getMappingsTelemetry(30);if(r)return;if(!p?.success)throw new Error(p?.error||"Failed to load telemetry");g(p),M(null)}catch(p){if(r)return;M(p?.message||"Failed to load telemetry")}finally{r||d(!1)}};c();const A=setInterval(c,2e4);return()=>{r=!0,clearInterval(A)}},[L]),m.useEffect(()=>{u&&a.warning(u)},[u]);const i=m.useMemo(()=>{const r=l?.totals||{},c=l?.kpis||{};return{events:Number(r.events||0),uniqueInternalCodes:Number(r.uniqueInternalCodes||0),overrides:Number(r.overrides||0),autoPct:Number(c.autoAccepted?.pct||0),reviewPct:Number(c.reviewRequired?.pct||0),rejectedPct:Number(c.rejected?.pct||0),noMatchPct:Number(c.noMatch?.pct||0),avgConfidence:Number(c.avgConfidence||0),avgLatencyMs:Number(c.avgLatencyMs||0),p95LatencyMs:Number(c.p95LatencyMs||0),overrideHits:Number(c.overrideHits?.count||0),noMatch:Number(c.noMatch?.count||0),rejected:Number(c.rejected?.count||0),facilities:Array.isArray(l?.facilities)?l.facilities:[],daily:Array.isArray(l?.daily)?l.daily:[],windowDays:Number(l?.windowDays||30),lastEventAt:l?.lastEventAt||null,config:l?.config||null}},[l]),f=r=>window.dispatchEvent(new CustomEvent("sbs:navigate",{detail:{view:r}}));return e.jsx("div",{className:"flex-1",children:e.jsxs("main",{className:"max-w-[1400px] mx-auto p-6 sm:p-8 space-y-8 stagger-children",children:[e.jsxs("section",{className:"animate-premium-in",children:[e.jsx(E,{title:t.header.title,subtitle:t.header.subtitle,badge:n?t.header.badgeLoading:t.header.badgeLive}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mt-8",children:[e.jsx(h,{testId:"mappings-stat-events",title:t.stats.mappingsObserved,value:x(i.events),trend:`${i.windowDays}d`,icon:"dataset",color:"blue"}),e.jsx(h,{testId:"mappings-stat-auto",title:t.stats.autoAcceptRate,value:`${w(i.autoPct)}%`,trend:`${w(i.avgConfidence*100)}% ${t.stats.avgConfidenceSuffix}`,icon:"psychology",color:"indigo"}),e.jsx(h,{testId:"mappings-stat-review",title:t.stats.reviewQueue,value:`${w(i.reviewPct)}%`,trend:`${x(i.uniqueInternalCodes)} ${t.stats.uniqueSuffix}`,icon:"fact_check",color:"emerald"}),e.jsx(h,{testId:"mappings-stat-latency",title:t.stats.p95Latency,value:C(i.p95LatencyMs),trend:`${C(i.avgLatencyMs)} ${t.stats.avgLatencySuffix}`,icon:"bolt",color:"amber"})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[e.jsx(N,{size:"sm",icon:"tune",onClick:()=>f("mapping_rules"),"data-testid":"mappings-open-rules",children:t.actions.configureRules}),e.jsx(N,{size:"sm",variant:"secondary",icon:"rule",onClick:()=>f("review"),"data-testid":"mappings-open-review",children:t.actions.openReviewQueue}),e.jsx(N,{size:"sm",variant:"secondary",icon:"refresh",onClick:()=>{d(!0),S(r=>r+1)},"data-testid":"mappings-refresh",children:t.actions.refresh}),i.lastEventAt&&e.jsxs("div",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:[t.lastEvent," ",e.jsx("span",{className:"text-slate-700 dark:text-slate-200",children:String(i.lastEventAt).replace("T"," ").slice(0,19)})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs(b,{className:"animate-premium-in",style:{animationDelay:"100ms"},children:[e.jsx(v,{title:t.charts.transformationAccuracy.title,subtitle:t.charts.transformationAccuracy.subtitle,action:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx($,{color:"bg-blue-600",label:t.charts.legend.volume}),e.jsx($,{color:"bg-indigo-400",label:t.charts.legend.avgConfidence})]})}),e.jsx(j,{children:e.jsx(P,{loading:n,daily:i.daily,t})})]}),e.jsxs(b,{className:"animate-premium-in",style:{animationDelay:"200ms"},children:[e.jsx(v,{title:t.facilities.title,subtitle:t.facilities.subtitle}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{"data-testid":"mappings-facility-table",className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500",children:t.facilities.table.facility}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500 text-right",children:t.facilities.table.volume}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500",children:t.facilities.table.avgConfidence}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase text-slate-500 text-right",children:t.facilities.table.overrides})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:i.facilities.length>0?i.facilities.map(r=>e.jsx(D,{facilityId:r.facilityId,volume:r.volume,avgConfidence:Number(r.avgConfidence||0),overrideHits:Number(r.overrideHits||0),warn:Number(r.avgConfidence||0)<Number(i.config?.reviewTrigger||.5),t},String(r.facilityId))):e.jsx("tr",{children:e.jsx("td",{className:"px-6 py-10 text-center text-xs font-bold text-slate-400",colSpan:4,children:n?t.facilities.empty.loading:t.facilities.empty.noData})})})]})})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs(b,{className:"animate-premium-in",style:{animationDelay:"300ms"},children:[e.jsx(v,{title:t.anomalies.title,subtitle:t.anomalies.subtitle}),e.jsxs(j,{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"size-44 rounded-full border-[12px] border-slate-100 dark:border-slate-800 relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-[12px] border-blue-600 border-t-transparent -rotate-45"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{"data-testid":"mappings-anomalies-total",className:"text-3xl font-black text-slate-900 dark:text-white",children:x(i.noMatch+i.rejected)}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:t.anomalies.totalFlags})]})]})}),e.jsxs("div",{className:"space-y-3","data-testid":"mappings-anomaly-list",children:[e.jsx(k,{label:t.anomalies.items.noMatch,count:i.noMatch,color:"bg-blue-600"}),e.jsx(k,{label:t.anomalies.items.rejectedLowConf,count:i.rejected,color:"bg-rose-500"}),e.jsx(k,{label:t.anomalies.items.overrideHits,count:i.overrideHits,color:"bg-indigo-500"})]})]})]}),e.jsx(b,{className:"bg-indigo-600 text-white animate-premium-in",style:{animationDelay:"400ms"},children:e.jsxs(j,{className:"p-8 text-center space-y-6",children:[e.jsx("div",{className:"size-16 rounded-2xl bg-white/20 backdrop-blur-md flex items-center justify-center mx-auto border border-white/20",children:e.jsx("span",{className:"material-symbols-outlined text-3xl",children:"auto_awesome"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xl font-black tracking-tight",children:t.aiAudit.title}),e.jsxs("p",{className:"text-sm font-bold text-indigo-100",children:[t.aiAudit.bodyLead," ",e.jsx("span",{className:"font-black",children:x(i.overrides)}),"."]})]}),e.jsx("button",{onClick:()=>f("mapping_rules"),className:"w-full py-4 bg-white text-indigo-600 rounded-2xl font-black uppercase tracking-widest text-[11px] shadow-xl transition-transform active:scale-95","data-testid":"mappings-review-governance",children:t.aiAudit.button})]})})]})]})]})})}function x(s){return(Number.isFinite(Number(s))?Number(s):0).toLocaleString()}function w(s){const a=Number.isFinite(Number(s))?Number(s):0;return Math.round(a*10)/10}function C(s){const a=Number.isFinite(Number(s))?Number(s):0;return a>=1e3?`${(a/1e3).toFixed(1)}s`:`${Math.round(a)}ms`}function h({testId:s,title:a,value:o,trend:t,icon:n,color:d}){const l={blue:"text-blue-600 bg-blue-600/10",indigo:"text-indigo-600 bg-indigo-600/10",emerald:"text-emerald-600 bg-emerald-600/10",amber:"text-amber-600 bg-amber-600/10"};return e.jsxs("div",{"data-testid":s,className:"glass-card p-6 rounded-[28px] border border-slate-200/50 dark:border-slate-800/50 hover:border-blue-600/30 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:`size-12 rounded-2xl flex items-center justify-center ${l[d]||l.blue} transition-transform group-hover:rotate-6`,children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:n})}),e.jsx("span",{className:"text-[11px] font-black px-2 py-1 rounded-lg bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",children:t})]}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 mb-1",children:a}),e.jsx("h4",{className:"text-3xl font-black text-slate-900 dark:text-white tracking-tighter",children:o})]})}function $({color:s,label:a}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`size-2.5 rounded-full ${s}`}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:a})]})}function D({facilityId:s,volume:a,avgConfidence:o,overrideHits:t,warn:n,t:d}){const l=Math.round(o*1e3)/10;return e.jsxs("tr",{className:"group hover:bg-slate-50/50 dark:hover:bg-slate-800/20 transition-colors",children:[e.jsx("td",{className:"px-6 py-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-10 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center font-black text-xs text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-all",children:String(s)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-900 dark:text-white",children:d.facilities.row.facilityLabel.replace("{id}",String(s))}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-slate-400",children:d.facilities.row.nodeLabel.replace("{id}",String(s))})]})]})}),e.jsx("td",{className:"px-6 py-5 text-right",children:e.jsx("p",{className:"text-sm font-black text-slate-700 dark:text-slate-300",children:x(a)})}),e.jsx("td",{className:"px-6 py-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-3 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden w-24 shadow-inner",children:e.jsx("div",{className:`h-full rounded-full ${n?"bg-amber-500":"bg-blue-600"} transition-all duration-1000`,style:{width:`${Math.max(0,Math.min(100,l))}%`}})}),e.jsxs("span",{className:`text-xs font-black ${n?"text-amber-600":"text-blue-600"}`,children:[l,"%"]})]})}),e.jsx("td",{className:"px-6 py-5 text-right",children:e.jsx("p",{className:"text-sm font-black text-slate-700 dark:text-slate-300",children:x(t)})})]})}function k({label:s,count:a,color:o}){return e.jsxs("div",{className:"flex items-center justify-between p-3.5 rounded-2xl bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors group cursor-pointer border border-transparent hover:border-slate-200 dark:hover:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`size-2.5 rounded-full ${o}`}),e.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-slate-300",children:s})]}),e.jsx("span",{className:"text-xs font-black text-slate-400 group-hover:text-blue-600",children:x(a)})]})}function P({loading:s,daily:a,t:o}){const t=Math.max(1,...a.map(n=>Number(n.volume||0)));return e.jsxs("div",{"data-testid":"mappings-daily-chart",className:"relative w-full h-[320px] rounded-2xl bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-600/5 to-transparent"}),s?e.jsx("div",{className:"relative h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"size-16 rounded-full bg-blue-600/10 flex items-center justify-center mx-auto text-blue-600",children:e.jsx("span",{className:"material-symbols-outlined text-3xl animate-spin",children:"progress_activity"})}),e.jsx("p",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest",children:o.charts.daily.loading})]})}):a.length===0?e.jsx("div",{className:"relative h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-3 opacity-70",children:[e.jsx("div",{className:"size-16 rounded-full bg-blue-600/10 flex items-center justify-center mx-auto text-blue-600",children:e.jsx("span",{className:"material-symbols-outlined text-3xl",children:"query_stats"})}),e.jsx("p",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest",children:o.charts.daily.empty})]})}):e.jsx("div",{className:"relative h-full px-6 py-8 flex items-end gap-1",children:a.map(n=>{const d=Number(n.volume||0),l=Math.max(0,Math.min(1,Number(n.avgConfidence||0))),g=Math.round(d/t*100),u=Math.round(l*100);return e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-end items-center gap-1",children:[e.jsx("div",{className:"w-full rounded-t bg-blue-600/70",style:{height:`${Math.max(2,g)}%`},title:`${n.day} volume=${d}`}),e.jsx("div",{className:"w-full rounded-t bg-indigo-400/70",style:{height:`${Math.max(2,u)}%`},title:`${n.day} avgConfidence=${Math.round(l*100)}%`})]},n.day)})})]})}export{Q as MappingsPage};
//# sourceMappingURL=MappingsPage-DuMM0jHo.js.map
